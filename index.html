<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AYK - متجر التقنية والأنظمة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        .hero-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .nav-link.active {
            color: #7c3aed;
            font-weight: 600;
        }
        
        .sidebar-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .status-pending { background-color: #fef3c7; color: #92400e; }
        .status-processing { background-color: #dbeafe; color: #1e40af; }
        .status-completed { background-color: #d1fae5; color: #065f46; }
        .status-cancelled { background-color: #fee2e2; color: #991b1b; }
        .status-new { background-color: #e0e7ff; color: #3730a3; }
        .status-contacted { background-color: #fef3c7; color: #92400e; }
        .status-in-progress { background-color: #dbeafe; color: #1e40af; }
        
        .admin-mode {
            display: none;
        }
        
        .admin-mode.active {
            display: block;
        }
        
        .user-mode.admin-active {
            display: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .category-filter {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-filter.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .stars {
            color: #fbbf24;
        }
        
        .service-card {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .service-card:hover {
            border-color: #7c3aed;
            transform: translateY(-2px);
        }
        
        /* أنماط محسنة للوحة الإدارة */
        .admin-section {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .admin-section table {
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .admin-section th {
            background-color: #f9fafb;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }
        
        .admin-section tr:hover {
            background-color: #f9fafb;
        }
        
        .stat-card {
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: #e5e7eb;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .form-input {
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
        }
        
        .form-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .notification-item {
            transition: all 0.3s ease;
        }
        
        .notification-item:hover {
            transform: translateX(-5px);
        }
        
        .chart-bar {
            transition: height 0.5s ease;
        }
        
        .chart-bar:hover {
            opacity: 0.8;
        }
        
        .sidebar-link {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .sidebar-link::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .sidebar-link:hover::before {
            transform: translateX(0);
        }
        
        .modal {
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from { 
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .message {
            animation: slideInRight 0.3s ease;
        }
        
        @keyframes slideInRight {
            from { 
                opacity: 0;
                transform: translateX(100%);
            }
            to { 
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @media (prefers-color-scheme: dark) {
            .admin-section {
                background-color: #1f2937;
                color: #f9fafb;
            }
            
            .admin-section table {
                background-color: #374151;
            }
            
            .admin-section th {
                background-color: #4b5563;
                color: #f9fafb;
            }
            
            .admin-section tr:hover {
                background-color: #4b5563;
            }
            
            .stat-card {
                background-color: #374151;
                color: #f9fafb;
            }
        }
        
        /* أضف هذا في قسم <style> أو ملف CSS خارجي */
        .dashboardStats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.08);
            padding: 32px 16px;
            text-align: center;
            position: relative;
            transition: box-shadow 0.3s;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .stat-card .icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            font-size: 2rem;
        }
        
        .stat-card .title {
            font-size: 1rem;
            color: #6b7280;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .stat-card .value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #7c3aed;
            margin-bottom: 4px;
        }
        
        .stat-card .subtitle {
            font-size: 0.95rem;
            color: #ef4444;
            margin-top: 4px;
            font-weight: 500;
        }
        
        .stat-card:hover {
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.18);
        }
        
        @media (max-width: 768px) {
            .dashboardStats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- User Interface -->
    <div id="userInterface" class="user-mode">
        <!-- Navigation -->
        <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 flex items-center">
                            <h1 class="text-2xl font-bold text-purple-600">AYK</h1>
                        </div>
                    </div>
                    <div class="hidden md:flex items-center space-x-8 space-x-reverse">
                        <a href="#home" class="nav-link active text-gray-700 hover:text-purple-600 px-3 py-2 rounded-md text-sm font-medium">الرئيسية</a>
                        <a href="#store" class="nav-link text-gray-700 hover:text-purple-600 px-3 py-2 rounded-md text-sm font-medium">المتجر</a>
                        <a href="#services" class="nav-link text-gray-700 hover:text-purple-600 px-3 py-2 rounded-md text-sm font-medium">الخدمات والأنظمة</a>
                        <a href="#contact" class="nav-link text-gray-700 hover:text-purple-600 px-3 py-2 rounded-md text-sm font-medium">اتصل بنا</a>
                        <button id="adminBtn" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-cog ml-2"></i>
                            الإدارة
                        </button>
                    </div>
                    
                    <!-- Mobile menu button -->
                    <div class="md:hidden flex items-center">
                        <button id="mobileMenuBtn" class="text-gray-700 hover:text-purple-600 p-2">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Mobile menu -->
                <div id="mobileMenu" class="md:hidden hidden bg-white border-t">
                    <div class="px-2 pt-2 pb-3 space-y-1">
                        <a href="#home" class="nav-link-mobile block px-3 py-2 text-gray-700 hover:text-purple-600">الرئيسية</a>
                        <a href="#store" class="nav-link-mobile block px-3 py-2 text-gray-700 hover:text-purple-600">المتجر</a>
                        <a href="#services" class="nav-link-mobile block px-3 py-2 text-gray-700 hover:text-purple-600">الخدمات والأنظمة</a>
                        <a href="#contact" class="nav-link-mobile block px-3 py-2 text-gray-700 hover:text-purple-600">اتصل بنا</a>
                        <button id="adminBtnMobile" class="w-full text-right bg-gray-600 text-white px-3 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-cog ml-2"></i>
                            الإدارة
                        </button>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Hero Section -->
        <section id="home" class="hero-bg text-white pt-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
                <div class="text-center fade-in">
                    <h2 class="text-4xl md:text-6xl font-bold mb-6">مرحباً بك في AYK</h2>
                    <p class="text-xl md:text-2xl mb-8">متجرك الأول للتقنية والأنظمة المتخصصة</p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button onclick="scrollToSection('store')" class="bg-white text-purple-600 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
                            تسوق الآن
                        </button>
                        <button onclick="scrollToSection('services')" class="bg-transparent border-2 border-white text-white px-8 py-3 rounded-lg font-semibold hover:bg-white hover:text-purple-600 transition-colors">
                            الأنظمة والخدمات
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Store Section -->
        <section id="store" class="py-16 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h3 class="text-3xl font-bold text-center mb-12 text-gray-800">المتجر الإلكتروني</h3>
                
                <!-- Search Bar -->
                <div class="max-w-md mx-auto mb-8">
                    <div class="relative">
                        <input type="text" id="searchInput" placeholder="ابحث عن المنتجات..." 
                               class="w-full p-3 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600">
                        <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>
                
                <!-- Category Filters -->
                <div class="flex flex-wrap justify-center gap-4 mb-8">
                    <button onclick="filterProducts('all')" class="category-filter active px-6 py-2 rounded-full bg-gray-200 text-gray-700">
                        جميع المنتجات
                    </button>
                    <button onclick="filterProducts('computers')" class="category-filter px-6 py-2 rounded-full bg-gray-200 text-gray-700">
                        حواسيب
                    </button>
                    <button onclick="filterProducts('phones')" class="category-filter px-6 py-2 rounded-full bg-gray-200 text-gray-700">
                        هواتف
                    </button>
                    <button onclick="filterProducts('accessories')" class="category-filter px-6 py-2 rounded-full bg-gray-200 text-gray-700">
                        إكسسوارات
                    </button>
                    <button onclick="filterProducts('stamps')" class="category-filter px-6 py-2 rounded-full bg-gray-200 text-gray-700">
                        طوابع
                    </button>
                </div>
                
                <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <!-- Products will be loaded here -->
                </div>
            </div>
        </section>
        
        <!-- Services Section -->
        <section id="services" class="py-16 bg-gray-100">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h3 class="text-3xl font-bold text-center mb-12 text-gray-800">الخدمات والأنظمة</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Company Systems -->
                    <div class="service-card p-6 rounded-lg">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-building text-blue-600 text-2xl"></i>
                            </div>
                            <h4 class="text-xl font-bold mb-2">أنظمة للشركات</h4>
                        </div>
                        <ul class="space-y-2 mb-6">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 ml-2"></i> نظام ERP متكامل</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 ml-2"></i> نظام محاسبة شامل</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 ml-2"></i> تقارير تفصيلية</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 ml-2"></i> إدارة الموظفين</li>
                        </ul>
                        <button onclick="showCustomSystemModal('company')" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                            اطلب نظام مخصص
                        </button>
                    </div>
                    
                    <!-- Restaurant Systems -->
                    <div class="service-card p-6 rounded-lg">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-utensils text-orange-600 text-2xl"></i>
                            </div>
                            <h4 class="text-xl font-bold mb-2">أنظمة للمطاعم</h4>
                        </div>
                        <ul class="space-y-2 mb-6">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 ml-2"></i> نظام كاشير متطور</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 ml-2"></i> إدارة الفواتير</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 ml-2"></i> نظام التوصيل</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 ml-2"></i> إدارة المخزون</li>
                        </ul>
                        <button onclick="showCustomSystemModal('restaurant')" class="w-full bg-orange-600 text-white py-2 rounded-lg hover:bg-orange-700">
                            اطلب نظام مخصص
                        </button>
                    </div>
                    
                    <!-- Pharmacy Systems -->
                    <div class="service-card p-6 rounded-lg">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-pills text-green-600 text-2xl"></i>
                            </div>
                            <h4 class="text-xl font-bold mb-2">أنظمة للصيدليات</h4>
                        </div>
                        <ul class="space-y-2 mb-6">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 ml-2"></i> إدارة الأدوية</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 ml-2"></i> تتبع المخزون</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 ml-2"></i> نظام الفواتير</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 ml-2"></i> تواريخ الانتهاء</li>
                        </ul>
                        <button onclick="showCustomSystemModal('pharmacy')" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">
                            اطلب نظام مخصص
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Contact Section -->
        <section id="contact" class="py-16 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h3 class="text-3xl font-bold text-center mb-12 text-gray-800">اتصل بنا</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h4 class="text-xl font-semibold mb-4">معلومات التواصل</h4>
                        <div class="space-y-3 mb-8">
                            <p class="flex items-center"><i class="fas fa-phone ml-3 text-purple-600"></i> +249 901068893</p>
                            <p class="flex items-center"><i class="fas fa-envelope ml-3 text-purple-600"></i> amaryasser408@.com</p>
                            <p class="flex items-center"><i class="fas fa-map-marker-alt ml-3 text-purple-600"></i> الخرطوم، السودان</p>
                        </div>
                        
                        <div class="bg-purple-50 p-6 rounded-lg">
                            <h5 class="font-semibold text-purple-800 mb-3">
                                <i class="fas fa-info-circle ml-2"></i>
                                كيف يمكننا مساعدتك؟
                            </h5>
                            <ul class="text-sm text-purple-700 space-y-2">
                                <li><i class="fas fa-check ml-2"></i> استفسارات عن المنتجات</li>
                                <li><i class="fas fa-check ml-2"></i> طلب عروض أسعار</li>
                                <li><i class="fas fa-check ml-2"></i> تطوير أنظمة مخصصة</li>
                                <li><i class="fas fa-check ml-2"></i> الدعم الفني</li>
                                <li><i class="fas fa-check ml-2"></i> الشراكات التجارية</li>
                            </ul>
                        </div>
                    </div>
                    <div>
                        <form id="contactForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    الاسم الكامل <span class="text-red-500">*</span>
                                </label>
                                <input type="text" id="contactName" placeholder="أدخل اسمك الكامل" 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    رقم الهاتف <span class="text-red-500">*</span>
                                </label>
                                <input type="tel" id="contactPhone" placeholder="09xxxxxxxx" 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    البريد الإلكتروني <span class="text-gray-500">(اختياري)</span>
                                </label>
                                <input type="email" id="contactEmail" placeholder="example@email.com" 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    نوع الطلب <span class="text-red-500">*</span>
                                </label>
                                <select id="contactType" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600" required>
                                    <option value="">اختر نوع الطلب</option>
                                    <option value="product">استفسار عن منتج</option>
                                    <option value="system">طلب نظام مخصص</option>
                                    <option value="project">مشروع تقني</option>
                                    <option value="support">دعم فني</option>
                                    <option value="partnership">شراكة تجارية</option>
                                    <option value="other">أخرى</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    وصف المنتج أو المشروع <span class="text-red-500">*</span>
                                </label>
                                <textarea id="contactDescription" placeholder="يرجى وصف احتياجاتك بالتفصيل..." 
                                          rows="5" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600" required></textarea>
                                <p class="text-xs text-gray-500 mt-1">
                                    كلما كان الوصف أكثر تفصيلاً، كلما تمكنا من تقديم خدمة أفضل لك
                                </p>
                            </div>
                            
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <label class="flex items-start">
                                    <input type="checkbox" id="contactConsent" class="mt-1 ml-2" required>
                                    <span class="text-sm text-gray-600">
                                        أوافق على <a href="#" class="text-purple-600 hover:underline">شروط الخدمة</a> 
                                        و <a href="#" class="text-purple-600 hover:underline">سياسة الخصوصية</a>
                                        وأسمح بالتواصل معي لمناقشة طلبي <span class="text-red-500">*</span>
                                    </span>
                                </label>
                            </div>
                            
                            <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors font-semibold">
                                <i class="fas fa-paper-plane ml-2"></i>
                                إرسال الطلب
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-12">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div>
                        <h3 class="text-xl font-bold mb-4">AYK</h3>
                        <p class="text-gray-300 mb-4">متجرك الأول للتقنية والأنظمة المتخصصة في السودان</p>
                        <div class="flex space-x-4 space-x-reverse">
                            <a href="#" class="text-gray-300 hover:text-white">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" class="text-gray-300 hover:text-white">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="text-gray-300 hover:text-white">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="#" class="text-gray-300 hover:text-white">
                                <i class="fab fa-linkedin"></i>
                            </a>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-semibold mb-4">روابط سريعة</h4>
                        <ul class="space-y-2">
                            <li><a href="#home" class="text-gray-300 hover:text-white">الرئيسية</a></li>
                            <li><a href="#store" class="text-gray-300 hover:text-white">المتجر</a></li>
                            <li><a href="#services" class="text-gray-300 hover:text-white">الخدمات</a></li>
                            <li><a href="#contact" class="text-gray-300 hover:text-white">اتصل بنا</a></li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-semibold mb-4">الخدمات</h4>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-gray-300 hover:text-white">أنظمة الشركات</a></li>
                            <li><a href="#" class="text-gray-300 hover:text-white">أنظمة المطاعم</a></li>
                            <li><a href="#" class="text-gray-300 hover:text-white">أنظمة الصيدليات</a></li>
                            <li><a href="#" class="text-gray-300 hover:text-white">الدعم الفني</a></li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-semibold mb-4">معلومات التواصل</h4>
                        <ul class="space-y-2">
                            <li class="flex items-center">
                                <i class="fas fa-phone ml-2"></i>
                                <span class="text-gray-300">+249 901068893</span>
                            </li>
                            <li class="flex items-center">
                                <i class="fas fa-envelope ml-2"></i>
                                <span class="text-gray-300">amaryasser408@gmail.com</span>
                            </li>
                            <li class="flex items-center">
                                <i class="fas fa-map-marker-alt ml-2"></i>
                                <span class="text-gray-300">الخرطوم، السودان</span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <div class="border-t border-gray-700 mt-8 pt-8 text-center">
                    <p class="text-gray-300">
                        powerd by:Ammar Kunna 
                    </p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Admin Login Screen -->
    <div id="adminLogin" class="admin-mode">
        <div class="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-md w-full space-y-8">
                <div>
                    <div class="mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-purple-100">
                        <i class="fas fa-lock text-purple-600 text-xl"></i>
                    </div>
                    <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
                        دخول الإدارة
                    </h2>
                    <p class="mt-2 text-center text-sm text-gray-600">
                        يرجى إدخال كلمة المرور للوصول إلى لوحة الإدارة
                    </p>
                </div>
                <form id="adminLoginForm" class="mt-8 space-y-6">
                    <div>
                        <label for="adminPassword" class="sr-only">كلمة المرور</label>
                        <input id="adminPassword" name="password" type="password" required 
                               class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-purple-500 focus:border-purple-500 focus:z-10 sm:text-sm" 
                               placeholder="كلمة المرور">
                    </div>
                    <div id="loginError" class="text-red-600 text-sm text-center hidden">
                        كلمة مرور خاطئة، يرجى المحاولة مرة أخرى
                    </div>
                    <div>
                        <button type="submit" class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                            <span class="absolute right-0 inset-y-0 flex items-center pr-3">
                                <i class="fas fa-sign-in-alt text-purple-500 group-hover:text-purple-400"></i>
                            </span>
                            دخول
                        </button>
                    </div>
                    <div class="text-center">
                        <button type="button" onclick="exitAdmin()" class="text-purple-600 hover:text-purple-500 text-sm">
                            العودة للموقع
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Admin Interface -->
    <div id="adminInterface" class="admin-mode">
        <div class="flex h-screen bg-gray-100">
            <!-- Sidebar -->
            <div class="w-64 bg-white shadow-lg">
                <div class="p-6">
                    <h2 class="text-2xl font-bold text-purple-600">لوحة الإدارة</h2>
                </div>
                <nav class="mt-6">
                    <a href="#" onclick="showAdminSection('dashboard')" class="admin-nav-link sidebar-active block px-6 py-3 text-white">
                        <i class="fas fa-tachometer-alt ml-3"></i>
                        الرئيسية
                    </a>
                    <a href="#" onclick="showAdminSection('products')" class="admin-nav-link block px-6 py-3 text-gray-700 hover:bg-gray-100">
                        <i class="fas fa-box ml-3"></i>
                        إدارة المنتجات
                    </a>
                    <a href="#" onclick="showAdminSection('orders')" class="admin-nav-link block px-6 py-3 text-gray-700 hover:bg-gray-100 relative">
                        <i class="fas fa-shopping-bag ml-3"></i>
                        الطلبات
                        <span id="ordersNotificationBadge" class="absolute top-2 left-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hidden">0</span>
                    </a>
                    <a href="#" onclick="showAdminSection('systems')" class="admin-nav-link block px-6 py-3 text-gray-700 hover:bg-gray-100 relative">
                        <i class="fas fa-cogs ml-3"></i>
                        طلبات الأنظمة
                        <span id="systemsNotificationBadge" class="absolute top-2 left-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hidden">0</span>
                    </a>
                    <a href="#" onclick="showAdminSection('contacts')" class="admin-nav-link block px-6 py-3 text-gray-700 hover:bg-gray-100 relative">
                        <i class="fas fa-envelope ml-3"></i>
                        طلبات التواصل
                        <span id="contactsNotificationBadge" class="absolute top-2 left-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hidden">0</span>
                    </a>
                    <a href="#" onclick="showAdminSection('reports')" class="admin-nav-link block px-6 py-3 text-gray-700 hover:bg-gray-100">
                        <i class="fas fa-chart-bar ml-3"></i>
                        التقارير
                    </a>
                    <a href="#" onclick="showAdminSection('backup')" class="admin-nav-link block px-6 py-3 text-gray-700 hover:bg-gray-100">
                        <i class="fas fa-database ml-3"></i>
                        النسخ الاحتياطي
                    </a>
                    <button id="adminNotificationBtn" onclick="openAdminNotifications()" class="w-full text-right px-6 py-3 text-purple-600 hover:bg-purple-50 relative">
                        <i class="fas fa-bell ml-3"></i>
                        الإشعارات
                        <span id="adminNotificationCount" class="absolute top-2 left-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hidden">0</span>
                    </button>
                    <button onclick="exitAdmin()" class="w-full text-right px-6 py-3 text-red-600 hover:bg-red-50">
                        <i class="fas fa-sign-out-alt ml-3"></i>
                        الخروج
                    </button>
                </nav>
            </div>
            
            <!-- Main Content -->
            <div class="flex-1 overflow-auto">
                <!-- Dashboard -->
                <div id="adminDashboard" class="admin-section p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold">لوحة التحكم</h3>
                        <div class="flex items-center space-x-3 space-x-reverse">
                            <button onclick="refreshDashboard()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                                <i class="fas fa-sync-alt ml-2"></i>
                                تحديث
                            </button>
                            <button onclick="exportDashboardData()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-download ml-2"></i>
                                تصدير البيانات
                            </button>
                        </div>
                    </div>
                    
                    <div id="dashboardStats" class="dashboardStats mb-8">
                        <!-- Stats will be loaded here -->
                    </div>
                    
                    <!-- Recent Activity -->
                    <div id="recentActivity" class="mb-6">
                        <!-- Recent activity will be loaded here -->
                    </div>
                    
                    <!-- Charts Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div id="salesChart">
                            <!-- Sales chart will be loaded here -->
                        </div>
                        <div id="ordersChart">
                            <!-- Orders chart will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div id="quickActions">
                        <!-- Quick actions will be loaded here -->
                    </div>
                </div>
                
                <!-- Products Management -->
                <div id="adminProducts" class="admin-section p-6" style="display: none;">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold">إدارة المنتجات</h3>
                        <button onclick="showAddProductModal()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            <i class="fas fa-plus ml-2"></i>
                            إضافة منتج
                        </button>
                    </div>
                    
                    <!-- Search and Filter -->
                    <div class="bg-white rounded-lg shadow p-4 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <input type="text" id="adminProductSearch" placeholder="بحث في المنتجات..." 
                                       class="w-full p-2 border rounded-lg">
                            </div>
                            <div>
                                <select id="adminProductCategory" class="w-full p-2 border rounded-lg">
                                    <option value="all">جميع الفئات</option>
                                    <option value="computers">حواسيب</option>
                                    <option value="phones">هواتف</option>
                                    <option value="accessories">إكسسوارات</option>
                                    <option value="stamps">طوابع</option>
                                </select>
                            </div>
                            <div class="flex items-center">
                                <button onclick="exportProducts()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                    <i class="fas fa-download ml-2"></i>
                                    تصدير
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="productsStats" class="mb-6">
                        <!-- Products stats will be loaded here -->
                    </div>
                    
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">المنتج</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">الفئة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">السعر</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">المخزون</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">التقييم</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="adminProductsList" class="divide-y divide-gray-200">
                                <!-- Products will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Orders Management -->
                <div id="adminOrders" class="admin-section p-6" style="display: none;">
                    <h3 class="text-2xl font-bold mb-6">إدارة الطلبات</h3>
                    
                    <!-- Search and Filter -->
                    <div class="bg-white rounded-lg shadow p-4 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <input type="text" id="adminOrderSearch" placeholder="بحث في الطلبات..." 
                                       class="w-full p-2 border rounded-lg">
                            </div>
                            <div>
                                <select id="adminOrderStatus" class="w-full p-2 border rounded-lg">
                                    <option value="all">جميع الحالات</option>
                                    <option value="pending">قيد الانتظار</option>
                                    <option value="processing">قيد المعالجة</option>
                                    <option value="completed">مكتمل</option>
                                    <option value="cancelled">ملغي</option>
                                </select>
                            </div>
                            <div class="flex items-center">
                                <button onclick="exportOrders()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                    <i class="fas fa-download ml-2"></i>
                                    تصدير
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="ordersStats" class="mb-6">
                        <!-- Orders stats will be loaded here -->
                    </div>
                    
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">رقم الطلب</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">العميل</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">المنتج</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">المبلغ</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">الحالة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="adminOrdersList" class="divide-y divide-gray-200">
                                <!-- Orders will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- System Requests Management -->
                <div id="adminSystems" class="admin-section p-6" style="display: none;">
                    <h3 class="text-2xl font-bold mb-6">طلبات الأنظمة المخصصة</h3>
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">رقم الطلب</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">نوع النظام</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">اسم الشركة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">رقم الاتصال</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">الحالة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="adminSystemsList" class="divide-y divide-gray-200">
                                <!-- System requests will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Contact Requests Management -->
                <div id="adminContacts" class="admin-section p-6" style="display: none;">
                    <h3 class="text-2xl font-bold mb-6">طلبات التواصل</h3>
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">رقم الطلب</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">الاسم</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">رقم الهاتف</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">نوع الطلب</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">التاريخ</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">الحالة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="adminContactsList" class="divide-y divide-gray-200">
                                <!-- Contact requests will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Reports Section -->
                <div id="adminReports" class="admin-section p-6" style="display: none;">
                    <!-- Reports will be loaded here -->
                </div>
                
                <!-- Backup Section -->
                <div id="adminBackup" class="admin-section p-6" style="display: none;">
                    <div id="backupSettings">
                        <!-- Backup settings will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Product Details Modal -->
    <div id="productDetailsModal" class="modal">
        <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 id="productDetailsTitle" class="text-2xl font-bold"></h3>
                <button onclick="closeProductDetails()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <img id="productDetailsImage" src="" alt="" class="w-full h-64 object-cover rounded-lg mb-4">
                    <div id="productDetailsRating" class="flex items-center mb-4">
                        <!-- Rating stars will be loaded here -->
                    </div>
                </div>
                <div>
                    <p id="productDetailsDescription" class="text-gray-600 mb-4"></p>
                    <p id="productDetailsPrice" class="text-3xl font-bold text-purple-600 mb-4"></p>
                    <p id="productDetailsStock" class="text-sm text-gray-500 mb-6"></p>
                    <button id="productDetailsAddToCart" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 mb-6">
                        اطلب الآن
                    </button>
                </div>
            </div>
            
            <!-- Reviews Section -->
            <div class="border-t pt-6">
                <h4 class="text-xl font-bold mb-4">مراجعات العملاء</h4>
                <div id="productReviews" class="space-y-4 mb-6">
                    <!-- Reviews will be loaded here -->
                </div>
                
                <!-- Add Review Form -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h5 class="font-semibold mb-3">أضف مراجعتك</h5>
                    <form id="reviewForm" class="space-y-3">
                        <input type="text" id="reviewerName" placeholder="اسمك" class="w-full p-2 border rounded" required>
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <span class="text-sm">التقييم:</span>
                            <div class="flex space-x-1 space-x-reverse">
                                <button type="button" class="star-btn text-gray-300 hover:text-yellow-400" data-rating="1">★</button>
                                <button type="button" class="star-btn text-gray-300 hover:text-yellow-400" data-rating="2">★</button>
                                <button type="button" class="star-btn text-gray-300 hover:text-yellow-400" data-rating="3">★</button>
                                <button type="button" class="star-btn text-gray-300 hover:text-yellow-400" data-rating="4">★</button>
                                <button type="button" class="star-btn text-gray-300 hover:text-yellow-400" data-rating="5">★</button>
                            </div>
                        </div>
                        <textarea id="reviewComment" placeholder="تعليقك" class="w-full p-2 border rounded" rows="3" required></textarea>
                        <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                            إضافة المراجعة
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">الإشعارات</h3>
                <button onclick="closeNotifications()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="notificationsList" class="space-y-3 mb-4 max-h-96 overflow-y-auto">
                <!-- Notifications will be loaded here -->
            </div>
            <div class="border-t pt-4">
                <button onclick="markAllAsRead()" class="w-full bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-700">
                    تحديد الكل كمقروء
                </button>
            </div>
        </div>
    </div>
    
    <!-- Order Confirmation Modal -->
    <div id="orderModal" class="modal">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">تأكيد الطلب</h3>
                <button onclick="closeOrderModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="orderProductInfo" class="mb-6">
                <!-- Product info will be loaded here -->
            </div>
            
            <form id="orderForm" class="space-y-4">
                <input type="hidden" id="orderProductId" value="">
                <input type="text" id="orderCustomerName" placeholder="الاسم الكامل" class="w-full p-3 border rounded-lg" required>
                <input type="tel" id="orderCustomerPhone" placeholder="رقم الهاتف" class="w-full p-3 border rounded-lg" required>
                <input type="email" id="orderCustomerEmail" placeholder="البريد الإلكتروني (اختياري)" class="w-full p-3 border rounded-lg">
                <textarea id="orderCustomerAddress" placeholder="العنوان" class="w-full p-3 border rounded-lg" rows="3" required></textarea>
                
                <div class="border-t pt-4">
                    <h4 class="font-semibold mb-3">طريقة الدفع</h4>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="orderPaymentMethod" value="cash" class="ml-2" checked>
                            <span>الدفع عند الاستلام</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="orderPaymentMethod" value="bank" class="ml-2">
                            <span>تحويل بنكي</span>
                        </label>
                    </div>
                </div>
                
                <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700">
                    تأكيد الطلب
                </button>
            </form>
        </div>
    </div>
    
    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">إضافة منتج جديد</h3>
                <button onclick="closeAddProductModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addProductForm" class="space-y-4">
                <input type="text" id="productName" placeholder="اسم المنتج" class="w-full p-3 border border-gray-300 rounded-lg" required>
                <select id="productCategory" class="w-full p-3 border border-gray-300 rounded-lg" required>
                    <option value="">اختر التصنيف</option>
                    <option value="computers">حواسيب</option>
                    <option value="phones">هواتف</option>
                    <option value="accessories">إكسسوارات</option>
                    <option value="stamps">طوابع</option>
                </select>
                <input type="number" id="productPrice" placeholder="السعر" class="w-full p-3 border border-gray-300 rounded-lg" required>
                <input type="number" id="productStock" placeholder="الكمية المتوفرة" class="w-full p-3 border border-gray-300 rounded-lg" required>
                <textarea id="productDescription" placeholder="وصف المنتج" class="w-full p-3 border border-gray-300 rounded-lg" rows="3"></textarea>
                <input type="url" id="productImage" placeholder="رابط الصورة" class="w-full p-3 border border-gray-300 rounded-lg">
                <button type="submit" class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700">
                    إضافة المنتج
                </button>
            </form>
        </div>
    </div>
    
    <!-- Custom System Request Modal -->
    <div id="customSystemModal" class="modal">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">طلب نظام مخصص</h3>
                <button onclick="closeCustomSystemModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="customSystemForm" class="space-y-4">
                <input type="hidden" id="systemType" value="">
                <input type="text" id="companyName" placeholder="اسم الشركة/المؤسسة" class="w-full p-3 border rounded-lg" required>
                <input type="text" id="contactPerson" placeholder="اسم الشخص المسؤول" class="w-full p-3 border rounded-lg" required>
                <input type="tel" id="contactPhone" placeholder="رقم الاتصال" class="w-full p-3 border rounded-lg" required>
                <input type="email" id="contactEmail" placeholder="البريد الإلكتروني" class="w-full p-3 border rounded-lg" required>
                <textarea id="systemRequirements" placeholder="متطلبات النظام والمميزات المطلوبة" class="w-full p-3 border rounded-lg" rows="4" required></textarea>
                <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700">
                    إرسال الطلب
                </button>
            </form>
        </div>
    </div>
    
    <!-- Contact Request Details Modal -->
    <div id="contactDetailsModal" class="modal">
        <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">تفاصيل طلب التواصل</h3>
                <button onclick="closeContactDetails()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="contactDetailsContent" class="space-y-4">
                <!-- Contact details will be loaded here -->
            </div>
        </div>
    </div>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBRRD0-u5L0hrSf-ZsG6TtuLBDhoFKvqi0",
            authDomain: "adiyat-tech.firebaseapp.com",
            databaseURL: "https://adiyat-tech-default-rtdb.firebaseio.com",
            projectId: "adiyat-tech",
            storageBucket: "adiyat-tech.firebasestorage.app",
            messagingSenderId: "991263010400",
            appId: "1:991263010400:web:fa20343c59b13e0ea3dd05",
            measurementId: "G-2MTENZZ3LD"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // إدارة الحالة المركزية
        const AppState = {
            isAdminMode: false,
            currentFilter: 'all',
            searchQuery: '',
            selectedRating: 0,
            editingProductId: null,
            
            updateState(newState) {
                Object.assign(this, newState);
                this.updateUI();
            },
            
            updateUI() {
                if (this.isAdminMode) {
                    updateAdminStats();
                }
            }
        };
        
        // Data Storage
        let contactRequests = [];
        let notifications = [];
        let products = [];
        let orders = [];
        let systemRequests = [];
        
        // Notification System
        class NotificationSystem {
            constructor() {
                this.notifications = [];
                this.init();
            }
            
            init() {
                this.loadNotifications();
                this.setupRealTimeListeners();
            }
            
            loadNotifications() {
                database.ref('notifications').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        this.notifications = Object.keys(data).map(key => ({
                            id: key,
                            ...data[key]
                        })).sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                    }
                    this.updateNotificationUI();
                });
            }
            
            setupRealTimeListeners() {
                database.ref('orders').on('child_added', (snapshot) => {
                    const order = snapshot.val();
                    if (order.status === 'pending') {
                        this.addNotification({
                            type: 'order',
                            title: `طلب جديد من ${order.customer}`,
                            message: `طلب ${order.product.name} بقيمة ${order.total} جنيه`,
                            icon: 'fas fa-shopping-bag',
                            color: 'green',
                            action: () => showAdminSection('orders')
                        });
                    }
                });
                
                database.ref('systemRequests').on('child_added', (snapshot) => {
                    const request = snapshot.val();
                    if (request.status === 'pending') {
                        this.addNotification({
                            type: 'system',
                            title: `طلب نظام جديد من ${request.companyName}`,
                            message: `طلب ${getSystemTypeText(request.systemType)}`,
                            icon: 'fas fa-cogs',
                            color: 'blue',
                            action: () => showAdminSection('systems')
                        });
                    }
                });
                
                database.ref('contactRequests').on('child_added', (snapshot) => {
                    const request = snapshot.val();
                    if (request.status === 'new') {
                        this.addNotification({
                            type: 'contact',
                            title: `طلب تواصل جديد من ${request.name}`,
                            message: `${getContactTypeText(request.type)}`,
                            icon: 'fas fa-envelope',
                            color: 'orange',
                            action: () => showAdminSection('contacts')
                        });
                    }
                });
            }
            
            addNotification(notification) {
                const newNotification = {
                    ...notification,
                    read: false,
                    timestamp: Date.now(),
                    date: new Date().toLocaleDateString('ar-SA'),
                    time: new Date().toLocaleTimeString('ar-SA')
                };
                database.ref('notifications').push(newNotification);
                this.showInstantNotification(newNotification);
            }
            
            showInstantNotification(notification) {
                const notificationElement = document.createElement('div');
                notificationElement.className = `fixed top-20 left-4 bg-white border-l-4 border-${notification.color}-500 p-4 rounded-lg shadow-lg z-50 max-w-sm transform translate-x-full transition-transform duration-300`;
                notificationElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 ml-3">
                            <i class="${notification.icon} text-${notification.color}-600 text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900">${sanitizeHTML(notification.title)}</h4>
                            <p class="text-sm text-gray-600 mt-1">${sanitizeHTML(notification.message)}</p>
                            <p class="text-xs text-gray-500 mt-2">${notification.date} - ${notification.time}</p>
                        </div>
                        <button onclick="this.closest('.fixed').remove()" class="flex-shrink-0 text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                document.body.appendChild(notificationElement);
                setTimeout(() => {
                    notificationElement.classList.remove('translate-x-full');
                }, 100);
                setTimeout(() => {
                    notificationElement.classList.add('translate-x-full');
                    setTimeout(() => {
                        notificationElement.remove();
                    }, 300);
                }, 5000);
            }
            
            updateNotificationUI() {
                this.updateNotificationCount();
                this.updateNotificationList();
            }
            
            updateNotificationCount() {
                const unreadCount = this.notifications.filter(n => !n.read).length;
                const badge = document.getElementById('adminNotificationCount');
                if (badge) {
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            }
            
            updateNotificationList() {
                const container = document.getElementById('notificationsList');
                if (!container) return;
                container.innerHTML = '';
                if (this.notifications.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="fas fa-bell-slash text-gray-300 text-3xl mb-3"></i>
                            <p class="text-gray-500">لا توجد إشعارات</p>
                        </div>
                    `;
                    return;
                }
                this.notifications.forEach(notification => {
                    const notificationElement = document.createElement('div');
                    notificationElement.className = `p-4 rounded-lg border-r-4 cursor-pointer transition-all hover:shadow-md ${
                        notification.read ? 'bg-gray-50 border-gray-300' : 'bg-white border-purple-500 shadow-sm'
                    }`;
                    
                    notificationElement.innerHTML = `
                        <div class="flex items-start">
                            <div class="flex-shrink-0 ml-3">
                                <i class="${notification.icon} text-${notification.color}-600 text-xl"></i>
                            </div>
                            <div class="flex-1">
                                <h5 class="font-semibold text-gray-900 ${notification.read ? '' : 'text-purple-600'}">${sanitizeHTML(notification.title)}</h5>
                                <p class="text-sm text-gray-600 mt-1">${sanitizeHTML(notification.message)}</p>
                                <p class="text-xs text-gray-500 mt-2">${notification.date} - ${notification.time}</p>
                            </div>
                            <div class="flex-shrink-0 flex items-center space-x-2 space-x-reverse">
                                ${!notification.read ? `
                                    <button onclick="markAsRead('${notification.id}')" class="text-purple-600 hover:text-purple-800 text-sm">
                                        <i class="fas fa-check"></i>
                                    </button>
                                ` : ''}
                                <button onclick="deleteNotification('${notification.id}')" class="text-red-600 hover:text-red-800 text-sm">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    if (notification.action) {
                        notificationElement.addEventListener('click', () => {
                            closeNotifications();
                            notification.action();
                        });
                    }
                    container.appendChild(notificationElement);
                });
            }
        }
        
        // Product Manager
        class ProductManager {
            constructor() {
                this.products = [];
                this.categories = ['computers', 'phones', 'accessories', 'stamps'];
                this.init();
            }
            
            init() {
                this.loadProducts();
                this.setupEventListeners();
            }
            
            loadProducts() {
                database.ref('products').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        this.products = Object.keys(data).map(key => ({
                            id: key,
                            ...data[key]
                        }));
                    } else {
                        this.initializeDefaultProducts();
                    }
                    this.updateProductsUI();
                });
            }
            
            initializeDefaultProducts() {
                const defaultProducts = [
                    {
                        name: "حاسوب محمول Dell XPS 15",
                        category: "computers",
                        price: 25000,
                        stock: 10,
                        description: "حاسوب محمول عالي الأداء مع معالج Intel Core i7",
                        image: "https://picsum.photos/seed/laptop1/400/300.jpg",
                        rating: 4.5,
                        reviews: []
                    },
                    {
                        name: "هاتف iPhone 13",
                        category: "phones",
                        price: 18000,
                        stock: 15,
                        description: "هاتف iPhone 13 بشاشة Super Retina XDR",
                        image: "https://picsum.photos/seed/iphone13/400/300.jpg",
                        rating: 4.8,
                        reviews: []
                    },
                    {
                        name: "سماعات AirPods Pro",
                        category: "accessories",
                        price: 2500,
                        stock: 25,
                        description: "سماعات لاسلكية مع إلغاء الضوضاء النشط",
                        image: "https://picsum.photos/seed/airpods/400/300.jpg",
                        rating: 4.3,
                        reviews: []
                    },
                    {
                        name: "طابع دفع الكتروني",
                        category: "stamps",
                        price: 800,
                        stock: 30,
                        description: "طابع دفع الكتروني للمتاجر والمطاعم",
                        image: "https://picsum.photos/seed/stamp1/400/300.jpg",
                        rating: 4.0,
                        reviews: []
                    }
                ];
                
                defaultProducts.forEach(product => {
                    database.ref('products').push({
                        ...product,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                });
            }
            
            setupEventListeners() {
                document.getElementById('addProductForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    if (AppState.editingProductId) {
                        this.updateProduct();
                    } else {
                        this.addProduct();
                    }
                });
                
                document.getElementById('adminProductSearch')?.addEventListener('input', (e) => {
                    this.searchProducts(e.target.value);
                });
                
                document.getElementById('adminProductCategory')?.addEventListener('change', (e) => {
                    this.filterByCategory(e.target.value);
                });
            }
            
            addProduct() {
                const formData = {
                    name: document.getElementById('productName').value,
                    category: document.getElementById('productCategory').value,
                    price: parseFloat(document.getElementById('productPrice').value),
                    stock: parseInt(document.getElementById('productStock').value),
                    description: document.getElementById('productDescription').value,
                    image: document.getElementById('productImage').value || this.generatePlaceholderImage(),
                    rating: 0,
                    reviews: [],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                if (!this.validateProduct(formData)) {
                    return;
                }
                
                database.ref('products').push(formData).then(() => {
                    closeAddProductModal();
                    showNotification('تم إضافة المنتج بنجاح');
                    this.resetForm();
                }).catch(error => {
                    console.error('Error adding product:', error);
                    showNotification('حدث خطأ في إضافة المنتج', 'error');
                });
            }
            
            updateProduct() {
                const name = document.getElementById('productName').value;
                const category = document.getElementById('productCategory').value;
                const price = parseFloat(document.getElementById('productPrice').value);
                const stock = parseInt(document.getElementById('productStock').value);
                const description = document.getElementById('productDescription').value;
                const image = document.getElementById('productImage').value;
                
                const updates = {
                    name,
                    category,
                    price,
                    stock,
                    description,
                    image,
                    updatedAt: new Date().toISOString()
                };
                
                if (!this.validateProduct(updates)) {
                    return;
                }
                
                updateProductInFirebase(AppState.editingProductId, updates).then(() => {
                    AppState.updateState({ editingProductId: null });
                    closeAddProductModal();
                    showNotification('تم تحديث المنتج بنجاح');
                    this.resetForm();
                }).catch(error => {
                    console.error('Error updating product:', error);
                    showNotification('حدث خطأ في تحديث المنتج', 'error');
                });
            }
            
            deleteProduct(productId) {
                if (!confirm('هل أنت متأكد من حذف هذا المنتج؟\nهذا الإجراء لا يمكن التراجع عنه.')) {
                    return;
                }
                
                const product = this.products.find(p => p.id == productId);
                if (product) {
                    deleteProductFromFirebase(product.id).then(() => {
                        showNotification('تم حذف المنتج بنجاح');
                        loadProducts();
                        updateAdminStats();
                    }).catch((error) => {
                        console.error('Error deleting product:', error);
                        showNotification('حدث خطأ في حذف المنتج', 'error');
                    });
                }
            }
            
            validateProduct(product) {
                if (!product.name || product.name.trim() === '') {
                    showNotification('يرجى إدخال اسم المنتج', 'error');
                    return false;
                }
                if (!product.category) {
                    showNotification('يرجى اختيار فئة المنتج', 'error');
                    return false;
                }
                if (!product.price || product.price <= 0) {
                    showNotification('يرجى إدخال سعر صحيح', 'error');
                    return false;
                }
                if (!product.stock || product.stock < 0) {
                    showNotification('يرجى إدخال كمية صحيحة', 'error');
                    return false;
                }
                return true;
            }
            
            generatePlaceholderImage() {
                const seed = Math.random().toString(36).substring(7);
                return `https://picsum.photos/seed/${seed}/400/300.jpg`;
            }
            
            updateProductsUI() {
                this.updateProductsTable();
                this.updateProductsStats();
            }
            
            updateProductsTable() {
                const tbody = document.getElementById('adminProductsList');
                if (!tbody) return;
                tbody.innerHTML = '';
                
                if (this.products.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                <i class="fas fa-box-open text-4xl mb-3 block"></i>
                                لا توجد منتجات
                                <br>
                                <button onclick="showAddProductModal()" class="mt-3 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                                    <i class="fas fa-plus ml-2"></i>
                                    إضافة منتج جديد
                                </button>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                this.products.forEach(product => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-colors';
                    
                    row.innerHTML = `
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <img src="${product.image}" alt="${sanitizeHTML(product.name)}" 
                                     class="w-12 h-12 object-cover rounded-lg ml-3 shadow-sm"
                                     onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'48\' height=\'48\' viewBox=\'0 0 48 48\'%3E%3Crect width=\'48\' height=\'48\' fill=\'%23f3f4f6\'/%3E%3Ctext x=\'24\' y=\'24\' text-anchor=\'middle\' fill=\'%23666\' font-size=\'12\'%3ENo Image%3C/text%3E%3C/svg%3E'">
                                <div>
                                    <div class="font-medium text-gray-900">${sanitizeHTML(product.name)}</div>
                                    <div class="text-sm text-gray-500">${sanitizeHTML(product.description) || 'لا يوجد وصف'}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">
                                ${this.getCategoryName(product.category)}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-semibold text-gray-900">${product.price} جنيه</div>
                            <div class="text-sm text-gray-500">السعر</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <span class="font-semibold ${product.stock <= 5 ? 'text-red-600' : 'text-green-600'}">
                                    ${product.stock}
                                </span>
                                <span class="text-sm text-gray-500 mr-1">قطعة</span>
                                ${product.stock <= 5 ? '<i class="fas fa-exclamation-triangle text-red-500 mr-2" title="مخزون منخفض"></i>' : ''}
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                ${generateStars(Math.floor(product.rating))}
                                <span class="text-sm text-gray-500 mr-2">(${product.rating || 0})</span>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <button onclick="editProduct('${product.id}')" 
                                        class="text-blue-600 hover:text-blue-800 p-2 rounded-lg hover:bg-blue-50 transition-colors"
                                        title="تعديل">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="duplicateProduct('${product.id}')" 
                                        class="text-green-600 hover:text-green-800 p-2 rounded-lg hover:bg-green-50 transition-colors"
                                        title="نسخ">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button onclick="productManager.deleteProduct('${product.id}')" 
                                        class="text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-red-50 transition-colors"
                                        title="حذف">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            updateProductsStats() {
                const totalProducts = this.products.length;
                const totalValue = this.products.reduce((sum, p) => sum + (p.price * p.stock), 0);
                const lowStock = this.products.filter(p => p.stock <= 5).length;
                const outOfStock = this.products.filter(p => p.stock === 0).length;
                
                const statsContainer = document.getElementById('productsStats');
                if (statsContainer) {
                    statsContainer.innerHTML = `
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            <div class="bg-white p-4 rounded-lg shadow">
                                <div class="text-2xl font-bold text-blue-600">${totalProducts}</div>
                                <div class="text-sm text-gray-500">إجمالي المنتجات</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow">
                                <div class="text-2xl font-bold text-green-600">${totalValue}</div>
                                <div class="text-sm text-gray-500">قيمة المخزون</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow">
                                <div class="text-2xl font-bold text-yellow-600">${lowStock}</div>
                                <div class="text-sm text-gray-500">مخزون منخفض</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow">
                                <div class="text-2xl font-bold text-red-600">${outOfStock}</div>
                                <div class="text-sm text-gray-500">نفد المخزون</div>
                            </div>
                        </div>
                    `;
                }
            }
            
            getCategoryName(category) {
                const names = {
                    'computers': 'حواسيب',
                    'phones': 'هواتف',
                    'accessories': 'إكسسوارات',
                    'stamps': 'طوابع'
                };
                return names[category] || category;
            }
            
            searchProducts(query) {
                const filtered = this.products.filter(p => 
                    p.name.toLowerCase().includes(query.toLowerCase()) ||
                    p.description.toLowerCase().includes(query.toLowerCase())
                );
                this.renderFilteredProducts(filtered);
            }
            
            filterByCategory(category) {
                const filtered = category === 'all' 
                    ? this.products 
                    : this.products.filter(p => p.category === category);
                this.renderFilteredProducts(filtered);
            }
            
            renderFilteredProducts(products) {
                const tbody = document.getElementById('adminProductsList');
                tbody.innerHTML = '';
                
                if (products.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                لا توجد منتجات تطابق البحث
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                products.forEach(product => {
                    // نفس الكود الموجود في updateProductsTable
                });
            }
            
            resetForm() {
                document.getElementById('addProductForm').reset();
                AppState.updateState({ editingProductId: null });
                document.querySelector('#addProductModal h3').textContent = 'إضافة منتج جديد';
                document.querySelector('#addProductForm button[type="submit"]').textContent = 'إضافة المنتج';
            }
        }
        
        // Order Manager
        class OrderManager {
            constructor() {
                this.orders = [];
                this.init();
            }
            
            init() {
                this.loadOrders();
                this.setupEventListeners();
            }
            
            loadOrders() {
                database.ref('orders').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        this.orders = Object.keys(data).map(key => ({
                            id: key,
                            ...data[key]
                        })).sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                    }
                    this.updateOrdersUI();
                });
            }
            
            setupEventListeners() {
                document.getElementById('adminOrderSearch')?.addEventListener('input', (e) => {
                    this.searchOrders(e.target.value);
                });
                
                document.getElementById('adminOrderStatus')?.addEventListener('change', (e) => {
                    this.filterByStatus(e.target.value);
                });
            }
            
            updateOrderStatus(orderId, newStatus) {
                const order = this.orders.find(o => o.id === orderId);
                if (!order) return;
                
                const updates = {
                    status: newStatus,
                    updatedAt: new Date().toISOString()
                };
                
                if (newStatus === 'completed') {
                    updates.completedAt = new Date().toISOString();
                } else if (newStatus === 'cancelled') {
                    updates.cancelledAt = new Date().toISOString();
                }
                
                updateOrderInFirebase(orderId, updates).then(() => {
                    showNotification('تم تحديث حالة الطلب بنجاح');
                    updateAdminNotificationCount();
                    updateAdminStats();
                }).catch(error => {
                    console.error('Error updating order status:', error);
                    showNotification('حدث خطأ في تحديث حالة الطلب', 'error');
                });
            }
            
            updateOrdersUI() {
                this.updateOrdersTable();
                this.updateOrdersStats();
                this.updateOrdersChart();
            }
            
            updateOrdersTable() {
                const tbody = document.getElementById('adminOrdersList');
                if (!tbody) return;
                tbody.innerHTML = '';
                
                if (this.orders.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                <i class="fas fa-shopping-bag text-4xl mb-3 block"></i>
                                لا توجد طلبات
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                this.orders.forEach(order => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-colors';
                    
                    row.innerHTML = `
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-900">#${order.orderNumber || order.id}</div>
                            <div class="text-sm text-gray-500">${order.date}</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <img src="${order.product?.image || 'https://via.placeholder.com/40'}" 
                                     alt="${sanitizeHTML(order.product?.name)}" 
                                     class="w-10 h-10 object-cover rounded-lg ml-3">
                                <div>
                                    <div class="font-medium">${sanitizeHTML(order.customer)}</div>
                                    <div class="text-sm text-gray-500">${order.phone}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-semibold text-gray-900">${order.total} جنيه</div>
                            <div class="text-sm text-gray-500">${order.paymentMethod === 'cash' ? 'نقدي' : 'تحويل بنكي'}</div>
                        </td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs rounded-full status-${order.status}">
                                ${getStatusText(order.status)}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <button onclick="showOrderDetails('${order.id}')" 
                                        class="text-blue-600 hover:text-blue-800 p-2 rounded-lg hover:bg-blue-50 transition-colors"
                                        title="عرض التفاصيل">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="printOrder('${order.id}')" 
                                        class="text-green-600 hover:text-green-800 p-2 rounded-lg hover:bg-green-50 transition-colors"
                                        title="طباعة">
                                    <i class="fas fa-print"></i>
                                </button>
                                <select onchange="orderManager.updateOrderStatus('${order.id}', this.value)" 
                                        class="text-sm border rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>قيد الانتظار</option>
                                    <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>قيد المعالجة</option>
                                    <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>مكتمل</option>
                                    <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>ملغي</option>
                                </select>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            updateOrdersStats() {
                const totalOrders = this.orders.length;
                const pendingOrders = this.orders.filter(o => o.status === 'pending').length;
                const completedOrders = this.orders.filter(o => o.status === 'completed').length;
                const cancelledOrders = this.orders.filter(o => o.status === 'cancelled').length;
                const totalRevenue = this.orders
                    .filter(o => o.status === 'completed')
                    .reduce((sum, o) => sum + (o.total || 0), 0);
                
                const statsContainer = document.getElementById('ordersStats');
                if (statsContainer) {
                    statsContainer.innerHTML = `
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                            <div class="bg-white p-4 rounded-lg shadow">
                                <div class="text-2xl font-bold text-blue-600">${totalOrders}</div>
                                <div class="text-sm text-gray-500">إجمالي الطلبات</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow">
                                <div class="text-2xl font-bold text-yellow-600">${pendingOrders}</div>
                                <div class="text-sm text-gray-500">قيد الانتظار</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow">
                                <div class="text-2xl font-bold text-green-600">${completedOrders}</div>
                                <div class="text-sm text-gray-500">مكتمل</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow">
                                <div class="text-2xl font-bold text-red-600">${cancelledOrders}</div>
                                <div class="text-sm text-gray-500">ملغي</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow">
                                <div class="text-2xl font-bold text-purple-600">${totalRevenue}</div>
                                <div class="text-sm text-gray-500">إجمالي المبيعات</div>
                            </div>
                        </div>
                    `;
                }
            }
            
            updateOrdersChart() {
                const chartContainer = document.getElementById('ordersChart');
                if (!chartContainer) return;
                
                const last7Days = [];
                const today = new Date();
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    last7Days.push(date.toISOString().split('T')[0]);
                }
                
                const ordersByDay = last7Days.map(date => {
                    return this.orders.filter(order => {
                        const orderDate = new Date(order.timestamp || 0).toISOString().split('T')[0];
                        return orderDate === date;
                    }).length;
                });
                
                const maxOrders = Math.max(...ordersByDay, 1);
                
                chartContainer.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-4">الطلبات خلال الأسبوع الماضي</h4>
                        <div class="flex items-end justify-between h-32">
                            ${ordersByDay.map((count, index) => {
                                const date = new Date(last7Days[index]);
                                const day = date.getDate();
                                const month = date.getMonth() + 1;
                                
                                return `
                                    <div class="flex flex-col items-center flex-1">
                                        <div class="bg-blue-500 rounded-t hover:bg-blue-600 transition-all chart-bar" 
                                             style="height: ${(count / maxOrders) * 100}%; width: 80%; min-height: 2px;"
                                             title="يوم ${day}/${month}: ${count} طلب">
                                        </div>
                                        <div class="text-xs text-gray-500 mt-2">${day}/${month}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }
            
            searchOrders(query) {
                const filtered = this.orders.filter(order => 
                    order.customer.toLowerCase().includes(query.toLowerCase()) ||
                    order.phone.includes(query) ||
                    (order.product && order.product.name.toLowerCase().includes(query.toLowerCase()))
                );
                this.renderFilteredOrders(filtered);
            }
            
            filterByStatus(status) {
                const filtered = status === 'all' 
                    ? this.orders 
                    : this.orders.filter(o => o.status === status);
                this.renderFilteredOrders(filtered);
            }
            
            renderFilteredOrders(orders) {
                const tbody = document.getElementById('adminOrdersList');
                tbody.innerHTML = '';
                
                if (orders.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                لا توجد طلبات تطابق البحث
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                orders.forEach(order => {
                    // نفس الكود الموجود في updateOrdersTable
                });
            }
            
            exportOrders() {
                const csvContent = [
                    ['رقم الطلب', 'العميل', 'الهاتف', 'المنتج', 'السعر', 'الحالة', 'التاريخ'],
                    ...this.orders.map(order => [
                        order.orderNumber || order.id,
                        order.customer,
                        order.phone,
                        order.product?.name || '',
                        order.total,
                        getStatusText(order.status),
                        order.date
                    ])
                ].map(row => row.join(',')).join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `orders-${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
            }
        }
        
        // Report Manager
        class ReportManager {
            constructor() {
                this.init();
            }
            
            init() {
                this.setupReportEventListeners();
            }
            
            setupReportEventListeners() {
                document.getElementById('generateReportBtn')?.addEventListener('click', () => {
                    this.generateReport();
                });
                
                document.getElementById('exportReportBtn')?.addEventListener('click', () => {
                    this.exportReport();
                });
            }
            
            generateReport() {
                const reportType = document.getElementById('reportType').value;
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                
                let reportData;
                switch (reportType) {
                    case 'sales':
                        reportData = this.generateSalesReport(startDate, endDate);
                        break;
                    case 'products':
                        reportData = this.generateProductsReport();
                        break;
                    case 'orders':
                        reportData = this.generateOrdersReport(startDate, endDate);
                        break;
                    case 'customers':
                        reportData = this.generateCustomersReport();
                        break;
                }
                
                this.displayReport(reportData, reportType);
            }
            
            generateSalesReport(startDate, endDate) {
                const filteredOrders = orders.filter(order => {
                    const orderDate = new Date(order.timestamp || 0);
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    return orderDate >= start && orderDate <= end && order.status === 'completed';
                });
                
                const totalSales = filteredOrders.reduce((sum, order) => sum + (order.total || 0), 0);
                const averageOrder = filteredOrders.length > 0 ? totalSales / filteredOrders.length : 0;
                
                const salesByProduct = {};
                filteredOrders.forEach(order => {
                    const productName = order.product?.name || 'منتج محذوف';
                    if (!salesByProduct[productName]) {
                        salesByProduct[productName] = { count: 0, revenue: 0 };
                    }
                    salesByProduct[productName].count++;
                    salesByProduct[productName].revenue += order.total || 0;
                });
                
                return {
                    title: 'تقرير المبيعات',
                    period: `${startDate} إلى ${endDate}`,
                    summary: {
                        totalSales: totalSales,
                        totalOrders: filteredOrders.length,
                        averageOrder: averageOrder
                    },
                    topProducts: Object.entries(salesByProduct)
                        .sort((a, b) => b[1].revenue - a[1].revenue)
                        .slice(0, 10)
                        .map(([name, data]) => ({ name, ...data }))
                };
            }
            
            generateProductsReport() {
                const totalProducts = products.length;
                const totalValue = products.reduce((sum, p) => sum + (p.price * p.stock), 0);
                const lowStock = products.filter(p => p.stock <= 5);
                const outOfStock = products.filter(p => p.stock === 0);
                
                const productsByCategory = {};
                products.forEach(product => {
                    if (!productsByCategory[product.category]) {
                        productsByCategory[product.category] = { count: 0, value: 0 };
                    }
                    productsByCategory[product.category].count++;
                    productsByCategory[product.category].value += product.price * product.stock;
                });
                
                return {
                    title: 'تقرير المنتجات',
                    summary: {
                        totalProducts: totalProducts,
                        totalValue: totalValue,
                        lowStock: lowStock.length,
                        outOfStock: outOfStock.length
                    },
                    byCategory: Object.entries(productsByCategory).map(([category, data]) => ({
                        category: this.getCategoryName(category),
                        ...data
                    })),
                    lowStockProducts: lowStock.map(p => ({
                        name: p.name,
                        stock: p.stock,
                        category: this.getCategoryName(p.category)
                    }))
                };
            }
            
            generateOrdersReport(startDate, endDate) {
                const filteredOrders = orders.filter(order => {
                    const orderDate = new Date(order.timestamp || 0);
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    return orderDate >= start && orderDate <= end;
                });
                
                const statusCounts = {
                    pending: filteredOrders.filter(o => o.status === 'pending').length,
                    processing: filteredOrders.filter(o => o.status === 'processing').length,
                    completed: filteredOrders.filter(o => o.status === 'completed').length,
                    cancelled: filteredOrders.filter(o => o.status === 'cancelled').length
                };
                
                const paymentMethods = {
                    cash: filteredOrders.filter(o => o.paymentMethod === 'cash').length,
                    bank: filteredOrders.filter(o => o.paymentMethod === 'bank').length
                };
                
                return {
                    title: 'تقرير الطلبات',
                    period: `${startDate} إلى ${endDate}`,
                    summary: {
                        totalOrders: filteredOrders.length,
                        statusCounts: statusCounts,
                        paymentMethods: paymentMethods
                    },
                    orders: filteredOrders.map(order => ({
                        id: order.id,
                        customer: order.customer,
                        product: order.product?.name,
                        total: order.total,
                        status: order.status,
                        date: order.date
                    }))
                };
            }
            
            generateCustomersReport() {
                const customerOrders = {};
                orders.forEach(order => {
                    if (!customerOrders[order.customer]) {
                        customerOrders[order.customer] = {
                            phone: order.phone,
                            orders: 0,
                            totalSpent: 0,
                            lastOrder: order.timestamp || 0
                        };
                    }
                    customerOrders[order.customer].orders++;
                    customerOrders[order.customer].totalSpent += order.total || 0;
                    customerOrders[order.customer].lastOrder = Math.max(
                        customerOrders[order.customer].lastOrder,
                        order.timestamp || 0
                    );
                });
                
                const customers = Object.entries(customerOrders).map(([name, data]) => ({
                    name,
                    ...data
                })).sort((a, b) => b.totalSpent - a.totalSpent);
                
                return {
                    title: 'تقرير العملاء',
                    summary: {
                        totalCustomers: customers.length,
                        averageOrders: customers.reduce((sum, c) => sum + c.orders, 0) / customers.length,
                        averageSpent: customers.reduce((sum, c) => sum + c.totalSpent, 0) / customers.length
                    },
                    topCustomers: customers.slice(0, 20)
                };
            }
            
            displayReport(reportData, reportType) {
                const container = document.getElementById('reportContent');
                if (!container) return;
                
                let html = `
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-2xl font-bold mb-4">${sanitizeHTML(reportData.title)}</h2>
                        ${reportData.period ? `<p class="text-gray-600 mb-6">الفترة: ${reportData.period}</p>` : ''}
                `;
                
                if (reportData.summary) {
                    html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">';
                    Object.entries(reportData.summary).forEach(([key, value]) => {
                        const label = this.getSummaryLabel(key);
                        html += `
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <p class="text-sm text-gray-600">${label}</p>
                                <p class="text-2xl font-bold text-gray-900">${this.formatValue(value)}</p>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                switch (reportType) {
                    case 'sales':
                        html += this.renderSalesReportTable(reportData);
                        break;
                    case 'products':
                        html += this.renderProductsReportTable(reportData);
                        break;
                    case 'orders':
                        html += this.renderOrdersReportTable(reportData);
                        break;
                    case 'customers':
                        html += this.renderCustomersReportTable(reportData);
                        break;
                }
                
                html += '</div>';
                container.innerHTML = html;
            }
            
            renderSalesReportTable(reportData) {
                return `
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3">أفضل المنتجات مبيعاً</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-right">المنتج</th>
                                        <th class="px-4 py-2 text-right">الكمية</th>
                                        <th class="px-4 py-2 text-right">الإيرادات</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y">
                                    ${reportData.topProducts.map(product => `
                                        <tr>
                                            <td class="px-4 py-2">${sanitizeHTML(product.name)}</td>
                                            <td class="px-4 py-2">${product.count}</td>
                                            <td class="px-4 py-2">${product.revenue.toLocaleString()} جنيه</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            renderProductsReportTable(reportData) {
                return `
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-3">المنتجات حسب الفئة</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-2 text-right">الفئة</th>
                                            <th class="px-4 py-2 text-right">العدد</th>
                                            <th class="px-4 py-2 text-right">القيمة</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y">
                                        ${reportData.byCategory.map(category => `
                                            <tr>
                                                <td class="px-4 py-2">${category.category}</td>
                                                <td class="px-4 py-2">${category.count}</td>
                                                <td class="px-4 py-2">${category.value.toLocaleString()} جنيه</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-3">المنتجات منخفضة المخزون</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-2 text-right">المنتج</th>
                                            <th class="px-4 py-2 text-right">المخزون</th>
                                            <th class="px-4 py-2 text-right">الفئة</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y">
                                        ${reportData.lowStockProducts.map(product => `
                                            <tr>
                                                <td class="px-4 py-2">${sanitizeHTML(product.name)}</td>
                                                <td class="px-4 py-2">
                                                    <span class="text-red-600 font-semibold">${product.stock}</span>
                                                </td>
                                                <td class="px-4 py-2">${product.category}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderOrdersReportTable(reportData) {
                return `
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3">تفاصيل الطلبات</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-right">رقم الطلب</th>
                                        <th class="px-4 py-2 text-right">العميل</th>
                                        <th class="px-4 py-2 text-right">المنتج</th>
                                        <th class="px-4 py-2 text-right">المبلغ</th>
                                        <th class="px-4 py-2 text-right">الحالة</th>
                                        <th class="px-4 py-2 text-right">التاريخ</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y">
                                    ${reportData.orders.map(order => `
                                        <tr>
                                            <td class="px-4 py-2">#${order.id}</td>
                                            <td class="px-4 py-2">${sanitizeHTML(order.customer)}</td>
                                            <td class="px-4 py-2">${sanitizeHTML(order.product)}</td>
                                            <td class="px-4 py-2">${order.total} جنيه</td>
                                            <td class="px-4 py-2">
                                                <span class="px-2 py-1 text-xs rounded-full status-${order.status}">
                                                    ${getStatusText(order.status)}
                                                </span>
                                            </td>
                                            <td class="px-4 py-2">${order.date}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            renderCustomersReportTable(reportData) {
                return `
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3">أفضل العملاء</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-right">العميل</th>
                                        <th class="px-4 py-2 text-right">الهاتف</th>
                                        <th class="px-4 py-2 text-right">عدد الطلبات</th>
                                        <th class="px-4 py-2 text-right">إجمالي الإنفاق</th>
                                        <th class="px-4 py-2 text-right">آخر طلب</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y">
                                    ${reportData.topCustomers.map(customer => `
                                        <tr>
                                            <td class="px-4 py-2 font-medium">${sanitizeHTML(customer.name)}</td>
                                            <td class="px-4 py-2">${customer.phone}</td>
                                            <td class="px-4 py-2">${customer.orders}</td>
                                            <td class="px-4 py-2">${customer.totalSpent.toLocaleString()} جنيه</td>
                                            <td class="px-4 py-2">${formatTime(customer.lastOrder)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            exportReport() {
                const reportType = document.getElementById('reportType').value;
                const format = document.getElementById('exportFormat').value;
                
                let reportData;
                switch (reportType) {
                    case 'sales':
                        reportData = this.generateSalesReport(
                            document.getElementById('startDate').value,
                            document.getElementById('endDate').value
                        );
                        break;
                    case 'products':
                        reportData = this.generateProductsReport();
                        break;
                    case 'orders':
                        reportData = this.generateOrdersReport(
                            document.getElementById('startDate').value,
                            document.getElementById('endDate').value
                        );
                        break;
                    case 'customers':
                        reportData = this.generateCustomersReport();
                        break;
                }
                
                if (format === 'csv') {
                    this.exportToCSV(reportData, reportType);
                } else if (format === 'pdf') {
                    this.exportToPDF(reportData, reportType);
                } else {
                    this.exportToJSON(reportData, reportType);
                }
            }
            
            exportToCSV(reportData, reportType) {
                let csvContent = '';
                
                switch (reportType) {
                    case 'sales':
                        csvContent = 'المنتج,الكمية,الإيرادات\n';
                        reportData.topProducts.forEach(product => {
                            csvContent += `${product.name},${product.count},${product.revenue}\n`;
                        });
                        break;
                    case 'products':
                        csvContent = 'الفئة,العدد,القيمة\n';
                        reportData.byCategory.forEach(category => {
                            csvContent += `${category.category},${category.count},${category.value}\n`;
                        });
                        break;
                    case 'orders':
                        csvContent = 'رقم الطلب,العميل,المنتج,المبلغ,الحالة,التاريخ\n';
                        reportData.orders.forEach(order => {
                            csvContent += `${order.id},${order.customer},${order.product},${order.total},${order.status},${order.date}\n`;
                        });
                        break;
                    case 'customers':
                        csvContent = 'العميل,الهاتف,عدد الطلبات,إجمالي الإنفاق\n';
                        reportData.topCustomers.forEach(customer => {
                            csvContent += `${customer.name},${customer.phone},${customer.orders},${customer.totalSpent}\n`;
                        });
                        break;
                }
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `${reportData.title.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
            }
            
            exportToJSON(reportData, reportType) {
                const jsonContent = JSON.stringify(reportData, null, 2);
                const blob = new Blob([jsonContent], { type: 'application/json;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `${reportData.title.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            }
            
            exportToPDF(reportData, reportType) {
                showNotification('تصدير PDF قيد التطوير', 'info');
            }
            
            getSummaryLabel(key) {
                const labels = {
                    totalSales: 'إجمالي المبيعات',
                    totalOrders: 'إجمالي الطلبات',
                    averageOrder: 'متوسط الطلب',
                    totalProducts: 'إجمالي المنتجات',
                    totalValue: 'قيمة المخزون',
                    lowStock: 'منخفض المخزون',
                    outOfStock: 'نفد المخزون',
                    totalCustomers: 'إجمالي العملاء',
                    averageOrders: 'متوسط الطلبات',
                    averageSpent: 'متوسط الإنفاق'
                };
                return labels[key] || key;
            }
            
            formatValue(value) {
                if (typeof value === 'number') {
                    return value.toLocaleString();
                }
                return value;
            }
            
            getCategoryName(category) {
                const names = {
                    'computers': 'حواسيب',
                    'phones': 'هواتف',
                    'accessories': 'إكسسوارات',
                    'stamps': 'طوابع'
                };
                return names[category] || category;
            }
        }
        
        // Backup Manager
        class BackupManager {
            constructor() {
                this.init();
            }
            
            init() {
                this.setupBackupEventListeners();
                this.scheduleAutoBackup();
            }
            
            setupBackupEventListeners() {
                document.getElementById('createBackupBtn')?.addEventListener('click', () => {
                    this.createBackup();
                });
                
                document.getElementById('restoreBackupBtn')?.addEventListener('click', () => {
                    this.restoreBackup();
                });
            }
            
            scheduleAutoBackup() {
                setInterval(() => {
                    this.createAutoBackup();
                }, 24 * 60 * 60 * 1000);
            }
            
            async createBackup() {
                try {
                    const backupData = {
                        timestamp: new Date().toISOString(),
                        version: '1.0',
                        data: {
                            products: products,
                            orders: orders,
                            systemRequests: systemRequests,
                            contactRequests: contactRequests,
                            notifications: notificationSystem?.notifications || []
                        }
                    };
                    
                    const backupBlob = new Blob([JSON.stringify(backupData, null, 2)], {
                        type: 'application/json'
                    });
                    
                    const backupRef = database.ref('backups').push();
                    await backupRef.set({
                        timestamp: backupData.timestamp,
                        size: backupBlob.size,
                        data: backupData
                    });
                    
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(backupBlob);
                    link.download = `ayk_backup_${new Date().toISOString().split('T')[0]}.json`;
                    link.click();
                    
                    showNotification('تم إنشاء النسخة الاحتياطية بنجاح');
                } catch (error) {
                    console.error('Error creating backup:', error);
                    showNotification('حدث خطأ في إنشاء النسخة الاحتياطية', 'error');
                }
            }
            
            async createAutoBackup() {
                try {
                    const backupData = {
                        timestamp: new Date().toISOString(),
                        version: '1.0',
                        auto: true,
                        data: {
                            products: products,
                            orders: orders,
                            systemRequests: systemRequests,
                            contactRequests: contactRequests
                        }
                    };
                    
                    await database.ref('backups/auto').push(backupData);
                    console.log('Auto backup created successfully');
                } catch (error) {
                    console.error('Error creating auto backup:', error);
                }
            }
            
            async restoreBackup() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    try {
                        const text = await file.text();
                        const backupData = JSON.parse(text);
                        
                        if (!this.validateBackup(backupData)) {
                            showNotification('ملف النسخة الاحتياطية غير صالح', 'error');
                            return;
                        }
                        
                        if (!confirm('هل أنت متأكد من استعادة النسخة الاحتياطية؟\nهذا الإجراء سيستبدل جميع البيانات الحالية.')) {
                            return;
                        }
                        
                        await this.restoreData(backupData.data);
                        showNotification('تم استعادة النسخة الاحتياطية بنجاح');
                        
                        setTimeout(() => {
                            location.reload();
                        }, 2000);
                    } catch (error) {
                        console.error('Error restoring backup:', error);
                        showNotification('حدث خطأ في استعادة النسخة الاحتياطية', 'error');
                    }
                };
                
                input.click();
            }
            
            validateBackup(backupData) {
                return backupData &&
                       backupData.version &&
                       backupData.data &&
                       backupData.data.products &&
                       backupData.data.orders &&
                       backupData.data.systemRequests &&
                       backupData.data.contactRequests;
            }
            
            async restoreData(data) {
                const promises = [];
                promises.push(database.ref('products').remove());
                promises.push(database.ref('orders').remove());
                promises.push(database.ref('systemRequests').remove());
                promises.push(database.ref('contactRequests').remove());
                
                await Promise.all(promises);
                
                const restorePromises = [];
                data.products.forEach(product => {
                    restorePromises.push(database.ref('products').push(product));
                });
                data.orders.forEach(order => {
                    restorePromises.push(database.ref('orders').push(order));
                });
                data.systemRequests.forEach(request => {
                    restorePromises.push(database.ref('systemRequests').push(request));
                });
                data.contactRequests.forEach(request => {
                    restorePromises.push(database.ref('contactRequests').push(request));
                });
                
                await Promise.all(restorePromises);
            }
            
            async getBackupList() {
                try {
                    const snapshot = await database.ref('backups').once('value');
                    const backups = snapshot.val();
                    
                    if (!backups) return [];
                    
                    return Object.keys(backups).map(key => ({
                        id: key,
                        ...backups[key]
                    })).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                } catch (error) {
                    console.error('Error getting backup list:', error);
                    return [];
                }
            }
            
            async deleteBackup(backupId) {
                try {
                    await database.ref(`backups/${backupId}`).remove();
                    showNotification('تم حذف النسخة الاحتياطية');
                } catch (error) {
                    console.error('Error deleting backup:', error);
                    showNotification('حدث خطأ في حذف النسخة الاحتياطية', 'error');
                }
            }
        }
        
        // Security Manager
        class SecurityManager {
            constructor() {
                this.init();
            }
            
            init() {
                this.setupSecurityEventListeners();
                this.checkSecurity();
            }
            
            setupSecurityEventListeners() {
                let failedAttempts = 0;
                
                document.getElementById('adminLoginForm').onsubmit = (e) => {
                    e.preventDefault();
                    const password = document.getElementById('adminPassword').value;
                    
                    if (password === 'amaryasser0928181077') {
                        failedAttempts = 0;
                        this.logSecurityEvent('login_success', 'Admin login successful');
                        enterAdminMode();
                        document.getElementById('loginError').classList.add('hidden');
                        document.getElementById('adminPassword').value = '';
                    } else {
                        failedAttempts++;
                        this.logSecurityEvent('login_failed', `Failed login attempt ${failedAttempts}`);
                        
                        if (failedAttempts >= 5) {
                            this.lockAccount();
                            return;
                        }
                        
                        document.getElementById('loginError').textContent = 
                            `كلمة مرور خاطئة. ${3 - failedAttempts} محاولات متبقية`;
                        document.getElementById('loginError').classList.remove('hidden');
                        document.getElementById('adminPassword').value = '';
                    }
                };
                
                this.setupXSSProtection();
                this.setupCSRFProtection();
            }
            
            setupXSSProtection() {
                window.sanitizeHTML = function(html) {
                    const temp = document.createElement('div');
                    temp.textContent = html;
                    return temp.innerHTML;
                };
            }
            
            setupCSRFProtection() {
                if (!localStorage.getItem('csrfToken')) {
                    localStorage.setItem('csrfToken', this.generateCSRFToken());
                }
                
                document.querySelectorAll('form').forEach(form => {
                    const csrfInput = document.createElement('input');
                    csrfInput.type = 'hidden';
                    csrfInput.name = 'csrf_token';
                    csrfInput.value = localStorage.getItem('csrfToken');
                    form.appendChild(csrfInput);
                });
            }
            
            generateCSRFToken() {
                return Array.from(crypto.getRandomValues(new Uint8Array(16)))
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join('');
            }
            
            checkSecurity() {
                if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                    console.warn('Warning: Site is not using HTTPS');
                }
            }
            
            logSecurityEvent(event, details) {
                const logEntry = {
                    event: event,
                    details: details,
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    ip: 'client-side'
                };
                database.ref('securityLogs').push(logEntry);
            }
            
            lockAccount() {
                this.logSecurityEvent('account_locked', 'Account locked due to multiple failed attempts');
                
                document.getElementById('adminPassword').disabled = true;
                document.getElementById('adminLoginForm').querySelector('button[type="submit"]').disabled = true;
                
                document.getElementById('loginError').textContent = 
                    'تم قفل الحساب مؤقتاً. يرجى المحاولة بعد 5 دقائق.';
                document.getElementById('loginError').classList.remove('hidden');
                
                setTimeout(() => {
                    document.getElementById('adminPassword').disabled = false;
                    document.getElementById('adminLoginForm').querySelector('button[type="submit"]').disabled = false;
                    document.getElementById('loginError').classList.add('hidden');
                }, 5 * 60 * 1000);
            }
        }
        
        // Initialize managers
        const notificationSystem = new NotificationSystem();
        const productManager = new ProductManager();
        const orderManager = new OrderManager();
        const reportManager = new ReportManager();
        const backupManager = new BackupManager();
        const securityManager = new SecurityManager();
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadProductsFromFirebase();
            loadOrdersFromFirebase();
            loadSystemRequestsFromFirebase();
            loadContactRequestsFromFirebase();
            updateAdminStats();
            
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    const target = this.getAttribute('href').substring(1);
                    scrollToSection(target);
                });
            });
            
            // Admin button
            document.getElementById('adminBtn').addEventListener('click', function() {
                showAdminLogin();
            });
            
            // Mobile menu
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                const mobileMenu = document.getElementById('mobileMenu');
                mobileMenu.classList.toggle('hidden');
            });
            
            // Mobile navigation
            document.querySelectorAll('.nav-link-mobile').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = this.getAttribute('href').substring(1);
                    scrollToSection(target);
                    document.getElementById('mobileMenu').classList.add('hidden');
                });
            });
            
            // Mobile admin button
            document.getElementById('adminBtnMobile').addEventListener('click', function() {
                showAdminLogin();
                document.getElementById('mobileMenu').classList.add('hidden');
            });
            
            // Forms
            document.getElementById('addProductForm').addEventListener('submit', function(e) {
                e.preventDefault();
                if (AppState.editingProductId) {
                    productManager.updateProduct();
                } else {
                    productManager.addProduct();
                }
            });
            
            document.getElementById('orderForm').addEventListener('submit', function(e) {
                e.preventDefault();
                processOrder();
            });
            
            document.getElementById('customSystemForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitSystemRequest();
            });
            
            document.getElementById('reviewForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addReview();
            });
            
            document.getElementById('contactForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitContactForm();
            });
            
            // Star rating
            document.querySelectorAll('.star-btn').forEach(star => {
                star.addEventListener('click', function() {
                    AppState.updateState({ selectedRating: parseInt(this.dataset.rating) });
                    updateStarDisplay();
                });
            });
            
            // Search functionality
            document.getElementById('searchInput').addEventListener('input', function() {
                AppState.updateState({ searchQuery: this.value.toLowerCase() });
                loadProducts();
            });
            
            // Setup secure admin access
            secureAdminAccess();
            
            // Setup modal click outside listener
            setupModalListeners();
        });
        
        // Firebase Functions
        function loadProductsFromFirebase() {
            database.ref('products').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    products = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    }));
                }
                loadProducts();
            });
        }
        
        function loadOrdersFromFirebase() {
            database.ref('orders').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    orders = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    }));
                    
                    // فرز الطلبات حسب الرقم التسلسلي
                    orders.sort((a, b) => (a.orderNumber || 0) - (b.orderNumber || 0));
                }
                if (AppState.isAdminMode) {
                    updateAdminNotificationCount();
                    loadAdminOrders();
                    updateAdminStats();
                }
            });
        }
        
        function loadSystemRequestsFromFirebase() {
            database.ref('systemRequests').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    systemRequests = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    }));
                    if (AppState.isAdminMode) {
                        updateAdminNotificationCount();
                        loadAdminSystemRequests();
                        updateAdminStats();
                    }
                }
            });
        }
        
        function loadContactRequestsFromFirebase() {
            database.ref('contactRequests').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    contactRequests = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    }));
                    if (AppState.isAdminMode) {
                        updateAdminNotificationCount();
                        loadAdminContactRequests();
                        updateAdminStats();
                    }
                }
            });
        }
        
        function saveProductToFirebase(product) {
            return database.ref('products').push(product);
        }
        
        function updateProductInFirebase(productId, updates) {
            return database.ref(`products/${productId}`).update(updates);
        }
        
        function deleteProductFromFirebase(productId) {
            return database.ref(`products/${productId}`).remove();
        }
        
        function saveOrderToFirebase(order) {
            return database.ref('orders').push(order);
        }
        
        function updateOrderInFirebase(orderId, updates) {
            return database.ref(`orders/${orderId}`).update(updates);
        }
        
        function saveSystemRequestToFirebase(request) {
            return database.ref('systemRequests').push(request);
        }
        
        function saveContactRequestToFirebase(request) {
            return database.ref('contactRequests').push(request);
        }
        
        function updateContactRequestInFirebase(requestId, updates) {
            return database.ref(`contactRequests/${requestId}`).update(updates);
        }
        
        // Utility Functions
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        function updateStarDisplay() {
            document.querySelectorAll('.star-btn').forEach((star, index) => {
                if (index < AppState.selectedRating) {
                    star.classList.remove('text-gray-300');
                    star.classList.add('text-yellow-400');
                } else {
                    star.classList.remove('text-yellow-400');
                    star.classList.add('text-gray-300');
                }
            });
        }
        
        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<i class="fas fa-star text-yellow-400"></i>';
                } else {
                    stars += '<i class="far fa-star text-gray-300"></i>';
                }
            }
            return stars;
        }
        
        // Product Functions
        function loadProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';
            
            let filteredProducts = AppState.currentFilter === 'all' 
                ? products 
                : products.filter(p => p.category === AppState.currentFilter);
                
            if (AppState.searchQuery) {
                filteredProducts = filteredProducts.filter(p => 
                    p.name.toLowerCase().includes(AppState.searchQuery) ||
                    p.description.toLowerCase().includes(AppState.searchQuery)
                );
            }
            
            if (filteredProducts.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-gray-500 text-lg">لا توجد منتجات تطابق البحث</p></div>';
            } else {
                filteredProducts.forEach(product => {
                    const productCard = createProductCard(product);
                    grid.appendChild(productCard);
                });
            }
        }
        
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-md overflow-hidden card-hover';
            card.innerHTML = `
                <img src="${product.image}" alt="${sanitizeHTML(product.name)}" class="product-image">
                <div class="p-4">
                    <h4 class="font-bold text-lg mb-2">${sanitizeHTML(product.name)}</h4>
                    <p class="text-gray-600 text-sm mb-3">${sanitizeHTML(product.description)}</p>
                    <div class="flex items-center mb-3">
                        ${generateStars(Math.floor(product.rating))}
                        <span class="mr-2 text-sm text-gray-600">(${product.rating})</span>
                    </div>
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-2xl font-bold text-purple-600">${product.price} جنيه</span>
                        <button onclick="orderProduct(${product.id})" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                            <i class="fas fa-shopping-bag ml-1"></i>
                            اطلب الآن
                        </button>
                    </div>
                    <div class="flex justify-between items-center">
                        <p class="text-sm text-gray-500">متوفر: ${product.stock} قطعة</p>
                        <button onclick="showProductDetails(${product.id})" class="text-purple-600 hover:text-purple-800 text-sm">
                            عرض التفاصيل
                        </button>
                    </div>
                </div>
            `;
            return card;
        }
        
        function filterProducts(category) {
            AppState.updateState({ currentFilter: category });
            
            document.querySelectorAll('.category-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadProducts();
        }
        
        function showProductDetails(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('productDetailsTitle').textContent = sanitizeHTML(product.name);
            document.getElementById('productDetailsImage').src = product.image;
            document.getElementById('productDetailsDescription').textContent = sanitizeHTML(product.description);
            document.getElementById('productDetailsPrice').textContent = `${product.price} جنيه`;
            document.getElementById('productDetailsStock').textContent = `متوفر: ${product.stock} قطعة`;
            
            document.getElementById('productDetailsRating').innerHTML = `
                ${generateStars(Math.floor(product.rating))}
                <span class="mr-2 text-sm text-gray-600">(${product.rating} من 5)</span>
            `;
            
            document.getElementById('productDetailsAddToCart').onclick = () => orderProduct(productId);
            loadProductReviews(product);
            document.getElementById('productDetailsModal').classList.add('active');
        }
        
        function loadProductReviews(product) {
            const reviewsContainer = document.getElementById('productReviews');
            reviewsContainer.innerHTML = '';
            
            if (product.reviews.length === 0) {
                reviewsContainer.innerHTML = '<p class="text-gray-500">لا توجد مراجعات بعد</p>';
                return;
            }
            
            product.reviews.forEach(review => {
                const reviewElement = document.createElement('div');
                reviewElement.className = 'bg-gray-50 p-4 rounded-lg';
                reviewElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h6 class="font-semibold">${sanitizeHTML(review.name)}</h6>
                        <div class="flex">
                            ${generateStars(review.rating)}
                        </div>
                    </div>
                    <p class="text-gray-600">${sanitizeHTML(review.comment)}</p>
                `;
                reviewsContainer.appendChild(reviewElement);
            });
        }
        
        function addReview() {
            const productId = parseInt(document.getElementById('productDetailsTitle').textContent.match(/\d+/)?.[0]) || 1;
            const product = products.find(p => p.id === productId);
            
            if (!product || AppState.selectedRating === 0) return;
            
            const reviewerName = document.getElementById('reviewerName').value;
            const reviewComment = document.getElementById('reviewComment').value;
            
            const newReview = {
                name: reviewerName,
                rating: AppState.selectedRating,
                comment: reviewComment
            };
            
            product.reviews.push(newReview);
            
            const totalRating = product.reviews.reduce((sum, review) => sum + review.rating, 0);
            product.rating = (totalRating / product.reviews.length).toFixed(1);
            
            document.getElementById('reviewForm').reset();
            AppState.updateState({ selectedRating: 0 });
            updateStarDisplay();
            loadProductReviews(product);
            loadProducts();
            
            showNotification('تم إضافة مراجعتك بنجاح');
        }
        
        function closeProductDetails() {
            document.getElementById('productDetailsModal').classList.remove('active');
        }
        
        // Order Functions
        function orderProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                showNotification('المنتج غير موجود', 'error');
                return;
            }
            
            if (product.stock <= 0) {
                showNotification('المنتج غير متوفر حالياً', 'error');
                return;
            }
            
            document.getElementById('orderProductId').value = productId;
            
            document.getElementById('orderProductInfo').innerHTML = `
                <div class="flex items-center p-4 bg-gray-50 rounded-lg">
                    <img src="${product.image}" alt="${sanitizeHTML(product.name)}" class="w-16 h-16 object-cover rounded ml-4">
                    <div>
                        <h4 class="font-semibold">${sanitizeHTML(product.name)}</h4>
                        <p class="text-gray-600 text-sm">${sanitizeHTML(product.description)}</p>
                        <p class="text-purple-600 font-bold text-lg">${product.price} جنيه</p>
                    </div>
                </div>
            `;
            document.getElementById('orderModal').classList.add('active');
        }
        
        function closeOrderModal() {
            document.getElementById('orderModal').classList.remove('active');
            document.getElementById('orderForm').reset();
        }
        
        function processOrder() {
            const productId = document.getElementById('orderProductId').value;
            const product = products.find(p => p.id === productId);
            
            if (!product || product.stock <= 0) {
                showNotification('المنتج غير متوفر', 'error');
                return;
            }
            
            const customerName = document.getElementById('orderCustomerName').value;
            const customerPhone = document.getElementById('orderCustomerPhone').value;
            const customerEmail = document.getElementById('orderCustomerEmail').value;
            const customerAddress = document.getElementById('orderCustomerAddress').value;
            const paymentMethod = document.querySelector('input[name="orderPaymentMethod"]:checked').value;
            
            // الحصول على رقم الطلب التالي
            const nextOrderNumber = orders.length > 0 
                ? Math.max(...orders.map(o => parseInt(o.orderNumber) || 0)) + 1 
                : 1;
            
            const order = {
                orderNumber: nextOrderNumber,
                customer: customerName,
                phone: customerPhone,
                email: customerEmail || 'غير محدد',
                address: customerAddress,
                paymentMethod: paymentMethod,
                product: {
                    id: productId,
                    name: product.name,
                    price: product.price,
                    image: product.image
                },
                total: product.price,
                status: 'pending',
                date: new Date().toLocaleDateString('ar-SA'),
                time: new Date().toLocaleTimeString('ar-SA'),
                timestamp: Date.now()
            };
            
            saveOrderToFirebase(order).then(() => {
                // استخدام معاملات Firebase لتحديث المخزون بأمان
                const productRef = database.ref(`products/${productId}`);
                productRef.transaction(currentProduct => {
                    if (currentProduct && currentProduct.stock > 0) {
                        return { ...currentProduct, stock: currentProduct.stock - 1 };
                    }
                    return; // إلغاء العملية إذا المخزون غير كافٍ
                }).then((result) => {
                    if (result.committed) {
                        closeOrderModal();
                        showNotification('تم إرسال طلبك بنجاح! سيتم التواصل معك قريباً');
                    } else {
                        showNotification('فشل تحديث المخزون، يرجى المحاولة مرة أخرى', 'error');
                    }
                }).catch((error) => {
                    console.error('Error updating stock:', error);
                    showNotification('حدث خطأ في تحديث المخزون', 'error');
                });
            }).catch((error) => {
                console.error('Error saving order:', error);
                showNotification('حدث خطأ في إرسال الطلب، يرجى المحاولة مرة أخرى', 'error');
            });
        }
        
        // Admin Functions
        function showAdminLogin() {
            document.getElementById('userInterface').classList.add('admin-active');
            document.getElementById('adminLogin').classList.add('active');
        }
        
        function enterAdminMode() {
            AppState.updateState({ isAdminMode: true });
            document.getElementById('adminLogin').classList.remove('active');
            document.getElementById('adminInterface').classList.add('active');
            updateAdminNotificationCount();
            updateAdminStats();
            loadAdminProducts();
            loadAdminOrders();
            loadAdminSystemRequests();
            loadAdminContactRequests();
            showAdminSection('dashboard');
        }
        
        function exitAdmin() {
            AppState.updateState({ isAdminMode: false });
            document.getElementById('userInterface').classList.remove('admin-active');
            document.getElementById('adminInterface').classList.remove('active');
            document.getElementById('adminLogin').classList.remove('active');
        }
        
        function showAdminSection(section) {
            // إخفاء جميع الأقسام
            document.querySelectorAll('.admin-section').forEach(s => {
                s.style.display = 'none';
            });
            
            // إزالة التنشيط من جميع الروابط
            document.querySelectorAll('.admin-nav-link').forEach(link => {
                link.classList.remove('sidebar-active', 'text-white');
                link.classList.add('text-gray-700');
            });
            
            // إظهار القسم المطلوب
            const targetSection = document.getElementById(`admin${section.charAt(0).toUpperCase() + section.slice(1)}`);
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            // تفعيل الرابط المطلوب
            const clickedLink = event ? event.target.closest('.admin-nav-link') : 
                           document.querySelector(`[onclick="showAdminSection('${section}')"]`);
            if (clickedLink) {
                clickedLink.classList.add('sidebar-active', 'text-white');
                clickedLink.classList.remove('text-gray-700');
            }
            
            // تحميل المحتوى الخاص بالقسم
            switch (section) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'products':
                    loadAdminProducts();
                    break;
                case 'orders':
                    loadAdminOrders();
                    break;
                case 'systems':
                    loadAdminSystemRequests();
                    break;
                case 'contacts':
                    loadAdminContactRequests();
                    break;
                case 'reports':
                    showReports();
                    break;
                case 'backup':
                    showBackupSettings();
                    break;
            }
        }
        
        function updateAdminStats() {
            if (!AppState.isAdminMode) return;
            
            // تحديث الإحصائيات الرئيسية
            const totalProductsElement = document.getElementById('totalProducts');
            if (totalProductsElement) totalProductsElement.textContent = products.length;
            
            const totalOrdersElement = document.getElementById('totalOrders');
            if (totalOrdersElement) totalOrdersElement.textContent = orders.length;
            
            const totalSystemRequestsElement = document.getElementById('totalSystemRequests');
            if (totalSystemRequestsElement) totalSystemRequestsElement.textContent = systemRequests.length;
            
            const totalContactRequestsElement = document.getElementById('totalContactRequests');
            if (totalContactRequestsElement) totalContactRequestsElement.textContent = contactRequests.length;
            
            // حساب إجمالي المبيعات
            const completedOrders = orders.filter(order => order.status === 'completed');
            const totalSales = completedOrders.reduce((total, order) => total + (order.total || 0), 0);
            const totalSalesElement = document.getElementById('totalSales');
            if (totalSalesElement) {
                totalSalesElement.textContent = `${totalSales.toLocaleString()} جنيه`;
            }
            
            // تحديث لوحة التحكم
            updateDashboard();
        }
        
        function updateDashboard() {
            if (!AppState.isAdminMode) return;
            
            updateStatsCards();
            updateRecentActivity();
            updateCharts();
            updateQuickActions();
        }
        
        function updateStatsCards() {
            const stats = {
                products: products.length,
                orders: orders.length,
                systemRequests: systemRequests.length,
                contactRequests: contactRequests.length,
                revenue: orders.filter(o => o.status === 'completed').reduce((sum, o) => sum + (o.total || 0), 0),
                pendingOrders: orders.filter(o => o.status === 'pending').length,
                lowStock: products.filter(p => p.stock <= 5).length,
                newContacts: contactRequests.filter(c => c.status === 'new').length
            };
            
            const container = document.getElementById('dashboardStats');
            if (container) {
                container.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer stat-card" onclick="showAdminSection('products')">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">المنتجات</p>
                                    <p class="text-2xl font-bold text-gray-900">${stats.products}</p>
                                    ${stats.lowStock > 0 ? `<p class="text-xs text-red-600 mt-1">${stats.lowStock} منخفض المخزون</p>` : ''}
                                </div>
                                <div class="p-3 bg-blue-100 rounded-full">
                                    <i class="fas fa-box text-blue-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer stat-card" onclick="showAdminSection('orders')">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">الطلبات</p>
                                    <p class="text-2xl font-bold text-gray-900">${stats.orders}</p>
                                    ${stats.pendingOrders > 0 ? `<p class="text-xs text-yellow-600 mt-1">${stats.pendingOrders} قيد الانتظار</p>` : ''}
                                </div>
                                <div class="p-3 bg-green-100 rounded-full">
                                    <i class="fas fa-shopping-bag text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow stat-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">المبيعات</p>
                                    <p class="text-2xl font-bold text-gray-900">${stats.revenue.toLocaleString()} جنيه</p>
                                    <p class="text-xs text-green-600 mt-1">إجمالي المبيعات</p>
                                </div>
                                <div class="p-3 bg-purple-100 rounded-full">
                                    <i class="fas fa-dollar-sign text-purple-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer stat-card" onclick="showAdminSection('contacts')">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">التواصل</p>
                                    <p class="text-2xl font-bold text-gray-900">${stats.contactRequests}</p>
                                    ${stats.newContacts > 0 ? `<p class="text-xs text-orange-600 mt-1">${stats.newContacts} جديد</p>` : ''}
                                </div>
                                <div class="p-3 bg-orange-100 rounded-full">
                                    <i class="fas fa-envelope text-orange-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        function updateRecentActivity() {
            const container = document.getElementById('recentActivity');
            if (!container) return;
            
            const activities = [
                ...orders.map(order => ({
                    type: 'order',
                    icon: 'fas fa-shopping-bag',
                    color: 'green',
                    title: `طلب جديد من ${order.customer}`,
                    time: order.timestamp,
                    action: () => showOrderDetails(order.id)
                })),
                ...systemRequests.map(request => ({
                    type: 'system',
                    icon: 'fas fa-cogs',
                    color: 'blue',
                    title: `طلب نظام من ${request.companyName}`,
                    time: request.timestamp,
                    action: () => showSystemRequestDetails(request.id)
                })),
                ...contactRequests.map(request => ({
                    type: 'contact',
                    icon: 'fas fa-envelope',
                    color: 'orange',
                    title: `اتصال من ${request.name}`,
                    time: request.timestamp,
                    action: () => showContactDetails(request.id)
                }))
            ].sort((a, b) => (b.time || 0) - (a.time || 0)).slice(0, 10);
            
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow">
                    <div class="p-6 border-b">
                        <h3 class="text-lg font-semibold">النشاط الحديث</h3>
                    </div>
                    <div class="divide-y">
                        ${activities.length === 0 ? `
                            <div class="p-8 text-center text-gray-500">
                                <i class="fas fa-clock text-4xl mb-3 block"></i>
                                لا يوجد نشاط حديث
                            </div>
                        ` : activities.map(activity => `
                            <div class="p-4 hover:bg-gray-50 cursor-pointer transition-colors" onclick="activity.action()">
                                <div class="flex items-center">
                                    <div class="p-2 bg-${activity.color}-100 rounded-full ml-3">
                                        <i class="${activity.icon} text-${activity.color}-600"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-medium text-gray-900">${sanitizeHTML(activity.title)}</p>
                                        <p class="text-sm text-gray-500">${formatTime(activity.time)}</p>
                                    </div>
                                    <i class="fas fa-chevron-left text-gray-400"></i>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function updateCharts() {
            updateSalesChart();
            updateOrdersChart();
        }
        
        function updateSalesChart() {
            const container = document.getElementById('salesChart');
            if (!container) return;
            
            const last30Days = [];
            const today = new Date();
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                last30Days.push(date.toISOString().split('T')[0]);
            }
            
            const salesByDay = last30Days.map(date => {
                return orders
                    .filter(order => {
                        const orderDate = new Date(order.timestamp || 0).toISOString().split('T')[0];
                        return orderDate === date && order.status === 'completed';
                    })
                    .reduce((sum, order) => sum + (order.total || 0), 0);
            });
            
            const maxSale = Math.max(...salesByDay, 1);
            
            container.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold mb-4">المبيعات خلال 30 يوم</h3>
                    <div class="h-64 flex items-end justify-between">
                        ${salesByDay.map((sale, index) => {
                            const date = new Date(last30Days[index]);
                            const day = date.getDate();
                            const month = date.getMonth() + 1;
                            
                            return `
                                <div class="flex flex-col items-center flex-1">
                                    <div class="bg-gradient-to-t from-purple-500 to-purple-600 rounded-t hover:from-purple-600 hover:to-purple-700 transition-all chart-bar" 
                                         style="height: ${(sale / maxSale) * 100}%; width: 60%; min-height: 2px;"
                                         title="يوم ${day}/${month}: ${sale} جنيه">
                                    </div>
                                    ${index % 5 === 0 ? `<div class="text-xs text-gray-500 mt-2">${day}/${month}</div>` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }
        
        function updateOrdersChart() {
            const container = document.getElementById('ordersChart');
            if (!container) return;
            
            const last7Days = [];
            const today = new Date();
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                last7Days.push(date.toISOString().split('T')[0]);
            }
            
            const ordersByDay = last7Days.map(date => {
                return orders.filter(order => {
                    const orderDate = new Date(order.timestamp || 0).toISOString().split('T')[0];
                    return orderDate === date;
                }).length;
            });
            
            const maxOrders = Math.max(...ordersByDay, 1);
            
            container.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold mb-4">الطلبات خلال الأسبوع الماضي</h3>
                    <div class="flex items-end justify-between h-32">
                        ${ordersByDay.map((count, index) => {
                            const date = new Date(last7Days[index]);
                            const day = date.getDate();
                            const month = date.getMonth() + 1;
                            
                            return `
                                <div class="flex flex-col items-center flex-1">
                                    <div class="bg-blue-500 rounded-t hover:bg-blue-600 transition-all chart-bar" 
                                         style="height: ${(count / maxOrders) * 100}%; width: 80%; min-height: 2px;"
                                         title="يوم ${day}/${month}: ${count} طلب">
                                    </div>
                                    <div class="text-xs text-gray-500 mt-2">${day}/${month}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }
        
        function updateQuickActions() {
            const container = document.getElementById('quickActions');
            if (!container) return;
            
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">إجراءات سريعة</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button onclick="showAddProductModal()" class="p-4 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors">
                            <i class="fas fa-plus text-blue-600 text-xl mb-2"></i>
                            <p class="text-sm font-medium">إضافة منتج</p>
                        </button>
                        <button onclick="showAdminSection('orders')" class="p-4 bg-green-50 rounded-lg hover:bg-green-100 transition-colors">
                            <i class="fas fa-shopping-bag text-green-600 text-xl mb-2"></i>
                            <p class="text-sm font-medium">الطلبات</p>
                            ${orders.filter(o => o.status === 'pending').length > 0 ? `
                                <span class="inline-block bg-red-500 text-white text-xs rounded-full px-2 py-1 mt-1">
                                    ${orders.filter(o => o.status === 'pending').length}
                                </span>
                            ` : ''}
                        </button>
                        <button onclick="exportData()" class="p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors">
                            <i class="fas fa-download text-purple-600 text-xl mb-2"></i>
                            <p class="text-sm font-medium">تصدير البيانات</p>
                        </button>
                        <button onclick="showAdminSection('reports')" class="p-4 bg-orange-50 rounded-lg hover:bg-orange-100 transition-colors">
                            <i class="fas fa-chart-bar text-orange-600 text-xl mb-2"></i>
                            <p class="text-sm font-medium">التقارير</p>
                        </button>
                    </div>
                </div>
            `;
        }
        
        function formatTime(timestamp) {
            if (!timestamp) return 'غير محدد';
            
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'الآن';
            if (diff < 3600000) return `${Math.floor(diff / 60000)} دقيقة`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)} ساعة`;
            if (diff < 604800000) return `${Math.floor(diff / 86400000)} يوم`;
            
            return formatDate(date);
        }
        
        function formatDate(date) {
            if (typeof Intl !== 'undefined' && Intl.DateTimeFormat) {
                return new Intl.DateTimeFormat('ar-EG', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                }).format(date);
            }
            
            // بديل للمتصفحات القديمة
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
        
        function refreshDashboard() {
            showNotification('جاري تحديث لوحة التحكم...');
            updateDashboard();
            setTimeout(() => {
                showNotification('تم تحديث لوحة التحكم بنجاح');
            }, 1000);
        }
        
        function exportDashboardData() {
            const dashboardData = {
                timestamp: new Date().toISOString(),
                statistics: {
                    totalProducts: products.length,
                    totalOrders: orders.length,
                    totalSystemRequests: systemRequests.length,
                    totalContactRequests: contactRequests.length,
                    totalSales: orders.filter(order => order.status === 'completed').reduce((total, order) => total + (order.total || 0), 0)
                },
                products: products,
                orders: orders,
                systemRequests: systemRequests,
                contactRequests: contactRequests
            };
            
            const dataStr = JSON.stringify(dashboardData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `ayk-dashboard-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showNotification('تم تصدير بيانات لوحة التحكم بنجاح');
        }
        
        function loadAdminProducts() {
            if (!AppState.isAdminMode) return;
            
            const tbody = document.getElementById('adminProductsList');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (products.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                            <i class="fas fa-box-open text-4xl mb-3 block"></i>
                            لا توجد منتجات
                            <br>
                            <button onclick="showAddProductModal()" class="mt-3 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                                <i class="fas fa-plus ml-2"></i>
                                إضافة منتج جديد
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                
                row.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <img src="${product.image}" alt="${sanitizeHTML(product.name)}" 
                                 class="w-12 h-12 object-cover rounded-lg ml-3 shadow-sm"
                                 onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'48\' height=\'48\' viewBox=\'0 0 48 48\'%3E%3Crect width=\'48\' height=\'48\' fill=\'%23f3f4f6\'/%3E%3Ctext x=\'24\' y=\'24\' text-anchor=\'middle\' fill=\'%23666\' font-size=\'12\'%3ENo Image%3C/text%3E%3C/svg%3E'">
                            <div>
                                <div class="font-medium text-gray-900">${sanitizeHTML(product.name)}</div>
                                <div class="text-sm text-gray-500">${sanitizeHTML(product.description) || 'لا يوجد وصف'}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">
                            ${productManager.getCategoryName(product.category)}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-semibold text-gray-900">${product.price} جنيه</div>
                        <div class="text-sm text-gray-500">السعر</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <span class="font-semibold ${product.stock <= 5 ? 'text-red-600' : 'text-green-600'}">
                                ${product.stock}
                            </span>
                            <span class="text-sm text-gray-500 mr-1">قطعة</span>
                            ${product.stock <= 5 ? '<i class="fas fa-exclamation-triangle text-red-500 mr-2" title="مخزون منخفض"></i>' : ''}
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            ${generateStars(Math.floor(product.rating))}
                            <span class="text-sm text-gray-500 mr-2">(${product.rating || 0})</span>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <button onclick="editProduct('${product.id}')" 
                                    class="text-blue-600 hover:text-blue-800 p-2 rounded-lg hover:bg-blue-50 transition-colors"
                                    title="تعديل">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="duplicateProduct('${product.id}')" 
                                    class="text-green-600 hover:text-green-800 p-2 rounded-lg hover:bg-green-50 transition-colors"
                                    title="نسخ">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button onclick="productManager.deleteProduct('${product.id}')" 
                                    class="text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-red-50 transition-colors"
                                    title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // تحديث إحصائيات المنتجات
            productManager.updateProductsStats();
        }
        
        function loadAdminOrders() {
            if (!AppState.isAdminMode) return;
            
            const tbody = document.getElementById('adminOrdersList');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (orders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                            <i class="fas fa-shopping-bag text-4xl mb-3 block"></i>
                            لا توجد طلبات
                        </td>
                    </tr>
                `;
                return;
            }
            
            orders.forEach(order => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                
                row.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="font-medium text-gray-900">#${order.orderNumber || order.id}</div>
                        <div class="text-sm text-gray-500">${order.date}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <img src="${order.product?.image || 'https://via.placeholder.com/40'}" 
                                 alt="${sanitizeHTML(order.product?.name)}" 
                                 class="w-10 h-10 object-cover rounded-lg ml-3">
                            <div>
                                <div class="font-medium">${sanitizeHTML(order.customer)}</div>
                                <div class="text-sm text-gray-500">${order.phone}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-semibold text-gray-900">${order.total} جنيه</div>
                        <div class="text-sm text-gray-500">${order.paymentMethod === 'cash' ? 'نقدي' : 'تحويل بنكي'}</div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs rounded-full status-${order.status}">
                            ${getStatusText(order.status)}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <button onclick="showOrderDetails('${order.id}')" 
                                    class="text-blue-600 hover:text-blue-800 p-2 rounded-lg hover:bg-blue-50 transition-colors"
                                    title="عرض التفاصيل">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="printOrder('${order.id}')" 
                                    class="text-green-600 hover:text-green-800 p-2 rounded-lg hover:bg-green-50 transition-colors"
                                    title="طباعة">
                                <i class="fas fa-print"></i>
                            </button>
                            <select onchange="orderManager.updateOrderStatus('${order.id}', this.value)" 
                                    class="text-sm border rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>قيد الانتظار</option>
                                <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>قيد المعالجة</option>
                                <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>مكتمل</option>
                                <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>ملغي</option>
                            </select>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // تحديث إحصائيات الطلبات
            orderManager.updateOrdersStats();
        }
        
        function loadAdminSystemRequests() {
            if (!AppState.isAdminMode) return;
            
            const tbody = document.getElementById('adminSystemsList');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (systemRequests.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                            <i class="fas fa-cogs text-4xl mb-3 block"></i>
                            لا توجد طلبات أنظمة
                        </td>
                    </tr>
                `;
                return;
            }
            
            systemRequests.forEach(request => {
                const systemTypeNames = {
                    'company': 'أنظمة الشركات',
                    'restaurant': 'أنظمة المطاعم',
                    'pharmacy': 'أنظمة الصيدليات'
                };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4">#${request.id}</td>
                    <td class="px-6 py-4">${systemTypeNames[request.systemType]}</td>
                    <td class="px-6 py-4">${sanitizeHTML(request.companyName)}</td>
                    <td class="px-6 py-4">${request.contactPhone}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs rounded-full status-${request.status}">
                            ${getStatusText(request.status)}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <button onclick="showSystemRequestDetails('${request.id}')" class="text-blue-600 hover:text-blue-800 ml-3">
                            <i class="fas fa-eye"></i>
                        </button>
                        <select onchange="updateSystemRequestStatus('${request.id}', this.value)" class="text-sm border rounded px-2 py-1">
                            <option value="pending" ${request.status === 'pending' ? 'selected' : ''}>قيد الانتظار</option>
                            <option value="contacted" ${request.status === 'contacted' ? 'selected' : ''}>تم التواصل</option>
                            <option value="in-progress" ${request.status === 'in-progress' ? 'selected' : ''}>قيد التطوير</option>
                            <option value="completed" ${request.status === 'completed' ? 'selected' : ''}>مكتمل</option>
                            <option value="cancelled" ${request.status === 'cancelled' ? 'selected' : ''}>ملغي</option>
                        </select>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadAdminContactRequests() {
            if (!AppState.isAdminMode) return;
            
            const tbody = document.getElementById('adminContactsList');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (contactRequests.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                            <i class="fas fa-envelope text-4xl mb-3 block"></i>
                            لا توجد طلبات تواصل
                        </td>
                    </tr>
                `;
                return;
            }
            
            contactRequests.forEach(request => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4">#${request.id}</td>
                    <td class="px-6 py-4">${sanitizeHTML(request.name)}</td>
                    <td class="px-6 py-4">${request.phone}</td>
                    <td class="px-6 py-4">${getContactTypeText(request.type)}</td>
                    <td class="px-6 py-4">${request.date}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs rounded-full status-${request.status}">
                            ${getContactStatusText(request.status)}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <button onclick="showContactDetails(${request.id})" class="text-blue-600 hover:text-blue-800 ml-3">
                            <i class="fas fa-eye"></i>
                        </button>
                        <select onchange="updateContactStatus(${request.id}, this.value)" class="text-sm border rounded px-2 py-1">
                            <option value="new" ${request.status === 'new' ? 'selected' : ''}>جديد</option>
                            <option value="contacted" ${request.status === 'contacted' ? 'selected' : ''}>تم التواصل</option>
                            <option value="in-progress" ${request.status === 'in-progress' ? 'selected' : ''}>قيد المعالجة</option>
                            <option value="completed" ${request.status === 'completed' ? 'selected' : ''}>مكتمل</option>
                        </select>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function showOrderDetails(orderId) {
            const order = orders.find(o => o.id == orderId);
            if (!order) return;
            
            const paymentMethodText = {
                'cash': 'الدفع عند الاستلام',
                'bank': 'تحويل بنكي'
            };
            
            const content = document.getElementById('contactDetailsContent');
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-2">معلومات العميل</h4>
                        <div class="bg-gray-50 p-4 rounded-lg space-y-2">
                            <p><strong>الاسم:</strong> ${sanitizeHTML(order.customer)}</p>
                            <p><strong>رقم الهاتف:</strong> ${order.phone}</p>
                            <p><strong>البريد الإلكتروني:</strong> ${order.email}</p>
                            <p><strong>العنوان:</strong> ${sanitizeHTML(order.address)}</p>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-2">تفاصيل الطلب</h4>
                        <div class="bg-gray-50 p-4 rounded-lg space-y-2">
                            <p><strong>رقم الطلب:</strong> #${order.orderNumber || order.id}</p>
                            <p><strong>التاريخ:</strong> ${order.date}</p>
                            <p><strong>الوقت:</strong> ${order.time}</p>
                            <p><strong>طريقة الدفع:</strong> ${paymentMethodText[order.paymentMethod]}</p>
                            <p><strong>الحالة:</strong> 
                                <span class="px-2 py-1 text-xs rounded-full status-${order.status}">
                                    ${getStatusText(order.status)}
                                </span>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <h4 class="font-semibold text-gray-700 mb-2">تفاصيل المنتج</h4>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="flex items-center">
                            <img src="${order.product.image}" alt="${sanitizeHTML(order.product.name)}" class="w-16 h-16 object-cover rounded ml-4">
                            <div class="flex-1">
                                <h5 class="font-semibold">${sanitizeHTML(order.product.name)}</h5>
                                <p class="text-gray-600">السعر: ${order.product.price} جنيه</p>
                                <p class="text-lg font-bold text-purple-600">المجموع: ${order.total} جنيه</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3 space-x-reverse">
                    <a href="tel:${order.phone}" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                        <i class="fas fa-phone ml-2"></i>
                        اتصال بالعميل
                    </a>
                    ${order.email !== 'غير محدد' ? `
                        <a href="mailto:${order.email}" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-envelope ml-2"></i>
                            إيميل
                        </a>
                    ` : ''}
                    <button onclick="printOrder('${order.id}')" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                        <i class="fas fa-print ml-2"></i>
                        طباعة
                    </button>
                </div>
            `;
            document.getElementById('contactDetailsModal').classList.add('active');
        }
        
        function printOrder(orderId) {
            const order = orders.find(o => o.id == orderId);
            if (!order) return;
            
            const printWindow = window.open('', '_blank');
            const paymentMethodText = {
                'cash': 'الدفع عند الاستلام',
                'bank': 'تحويل بنكي'
            };
            
            // تحويل التاريخ إلى صيغة أكثر وضوحاً
            const orderDate = new Date(order.date);
            const formattedDate = formatDate(orderDate);
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>طلب رقم ${order.orderNumber || order.id}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 20px; }
                        .section { margin-bottom: 20px; }
                        .section h3 { background: #f5f5f5; padding: 10px; margin: 0; }
                        .details { padding: 10px; border: 1px solid #ddd; }
                        .product { display: flex; align-items: center; gap: 15px; }
                        .total { font-size: 18px; font-weight: bold; color: #7c3aed; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>AYK - متجر التقنية والأنظمة</h1>
                        <h2>فاتورة طلب رقم #${order.orderNumber || order.id}</h2>
                        <p>التاريخ: ${formattedDate} - الوقت: ${order.time}</p>
                    </div>
                    
                    <div class="section">
                        <h3>معلومات العميل</h3>
                        <div class="details">
                            <p><strong>الاسم:</strong> ${sanitizeHTML(order.customer)}</p>
                            <p><strong>رقم الهاتف:</strong> ${order.phone}</p>
                            <p><strong>البريد الإلكتروني:</strong> ${order.email}</p>
                            <p><strong>العنوان:</strong> ${sanitizeHTML(order.address)}</p>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h3>تفاصيل المنتج</h3>
                        <div class="details">
                            <div class="product">
                                <div>
                                    <h4>${sanitizeHTML(order.product.name)}</h4>
                                    <p>السعر: ${order.product.price} جنيه</p>
                                    <p>الكمية: 1</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h3>معلومات الدفع</h3>
                        <div class="details">
                            <p><strong>طريقة الدفع:</strong> ${paymentMethodText[order.paymentMethod]}</p>
                            <p class="total"><strong>المجموع الكلي: ${order.total} جنيه</strong></p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 40px; font-size: 12px; color: #666;">
                        <p>شكراً لتسوقكم معنا</p>
                        <p>للاستفسارات: +249 91 123 4567 | info@ayk.com</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }
        
        function showSystemRequestDetails(requestId) {
            const request = systemRequests.find(r => r.id == requestId);
            if (!request) return;
            
            const systemTypeNames = {
                'company': 'أنظمة الشركات',
                'restaurant': 'أنظمة المطاعم',
                'pharmacy': 'أنظمة الصيدليات'
            };
            
            const content = document.getElementById('contactDetailsContent');
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-2">معلومات الشركة</h4>
                        <div class="bg-gray-50 p-4 rounded-lg space-y-2">
                            <p><strong>اسم الشركة:</strong> ${sanitizeHTML(request.companyName)}</p>
                            <p><strong>الشخص المسؤول:</strong> ${sanitizeHTML(request.contactPerson)}</p>
                            <p><strong>رقم الاتصال:</strong> ${request.contactPhone}</p>
                            <p><strong>البريد الإلكتروني:</strong> ${request.contactEmail}</p>
                            <p><strong>نوع النظام:</strong> ${systemTypeNames[request.systemType]}</p>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-2">تفاصيل الطلب</h4>
                        <div class="bg-gray-50 p-4 rounded-lg space-y-2">
                            <p><strong>التاريخ:</strong> ${request.date}</p>
                            <p><strong>الوقت:</strong> ${request.time || 'غير محدد'}</p>
                            <p><strong>الحالة:</strong> 
                                <span class="px-2 py-1 text-xs rounded-full status-${request.status}">
                                    ${getStatusText(request.status)}
                                </span>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <h4 class="font-semibold text-gray-700 mb-2">متطلبات النظام</h4>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="whitespace-pre-wrap">${sanitizeHTML(request.requirements)}</p>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3 space-x-reverse">
                    <a href="tel:${request.contactPhone}" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                        <i class="fas fa-phone ml-2"></i>
                        اتصال
                    </a>
                    <a href="mailto:${request.contactEmail}" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-envelope ml-2"></i>
                        إيميل
                    </a>
                </div>
            `;
            document.getElementById('contactDetailsModal').classList.add('active');
        }
        
        function updateSystemRequestStatus(requestId, newStatus) {
            const request = systemRequests.find(r => r.id == requestId);
            if (request) {
                database.ref(`systemRequests/${request.id}`).update({ status: newStatus }).then(() => {
                    showNotification('تم تحديث حالة طلب النظام');
                    updateAdminNotificationCount();
                }).catch((error) => {
                    console.error('Error updating system request status:', error);
                    showNotification('حدث خطأ في تحديث الحالة', 'error');
                });
            }
        }
        
        function showContactDetails(requestId) {
            const request = contactRequests.find(r => r.id == requestId);
            if (!request) return;
            
            const content = document.getElementById('contactDetailsContent');
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-2">معلومات العميل</h4>
                        <div class="bg-gray-50 p-4 rounded-lg space-y-2">
                            <p><strong>الاسم:</strong> ${sanitizeHTML(request.name)}</p>
                            <p><strong>رقم الهاتف:</strong> ${request.phone}</p>
                            <p><strong>البريد الإلكتروني:</strong> ${request.email}</p>
                            <p><strong>نوع الطلب:</strong> ${getContactTypeText(request.type)}</p>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-2">تفاصيل الطلب</h4>
                        <div class="bg-gray-50 p-4 rounded-lg space-y-2">
                            <p><strong>التاريخ:</strong> ${request.date}</p>
                            <p><strong>الوقت:</strong> ${request.time}</p>
                            <p><strong>الحالة:</strong> 
                                <span class="px-2 py-1 text-xs rounded-full status-${request.status}">
                                    ${getContactStatusText(request.status)}
                                </span>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <h4 class="font-semibold text-gray-700 mb-2">وصف المنتج أو المشروع</h4>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="whitespace-pre-wrap">${sanitizeHTML(request.description)}</p>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3 space-x-reverse">
                    <a href="tel:${request.phone}" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                        <i class="fas fa-phone ml-2"></i>
                        اتصال
                    </a>
                    ${request.email !== 'غير محدد' ? `
                        <a href="mailto:${request.email}" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-envelope ml-2"></i>
                            إيميل
                        </a>
                    ` : ''}
                </div>
            `;
            document.getElementById('contactDetailsModal').classList.add('active');
        }
        
        function closeContactDetails() {
            document.getElementById('contactDetailsModal').classList.remove('active');
        }
        
        function getContactStatusText(status) {
            const statusMap = {
                'new': 'جديد',
                'contacted': 'تم التواصل',
                'in-progress': 'قيد المعالجة',
                'completed': 'مكتمل'
            };
            return statusMap[status] || status;
        }
        
        function getStatusText(status) {
            const statusMap = {
                'pending': 'قيد الانتظار',
                'processing': 'قيد المعالجة',
                'completed': 'مكتمل',
                'cancelled': 'ملغي'
            };
            return statusMap[status] || status;
        }
        
        function updateOrderStatus(orderId, newStatus) {
            const order = orders.find(o => o.id == orderId);
            if (order) {
                updateOrderInFirebase(order.id, { status: newStatus }).then(() => {
                    showNotification('تم تحديث حالة الطلب');
                    updateAdminNotificationCount();
                    updateAdminStats();
                }).catch((error) => {
                    console.error('Error updating order status:', error);
                    showNotification('حدث خطأ في تحديث الحالة', 'error');
                });
            }
        }
        
        function showAddProductModal() {
            document.getElementById('addProductModal').classList.add('active');
        }
        
        function closeAddProductModal() {
            document.getElementById('addProductModal').classList.remove('active');
            document.getElementById('addProductForm').reset();
            AppState.updateState({ editingProductId: null });
            
            document.querySelector('#addProductModal h3').textContent = 'إضافة منتج جديد';
            document.querySelector('#addProductForm button[type="submit"]').textContent = 'إضافة المنتج';
        }
        
        function editProduct(productId) {
            const product = products.find(p => p.id == productId);
            if (product) {
                AppState.updateState({ editingProductId: productId });
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productDescription').value = product.description || '';
                document.getElementById('productImage').value = product.image || '';
                
                document.querySelector('#addProductModal h3').textContent = 'تعديل المنتج';
                document.querySelector('#addProductForm button[type="submit"]').textContent = 'حفظ التعديلات';
                
                showAddProductModal();
            }
        }
        
        function duplicateProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const duplicatedProduct = {
                ...product,
                name: `${product.name} (نسخة)`,
                stock: 0,
                rating: 0,
                reviews: [],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            delete duplicatedProduct.id;
            
            database.ref('products').push(duplicatedProduct).then(() => {
                showNotification('تم نسخ المنتج بنجاح');
            }).catch(error => {
                console.error('Error duplicating product:', error);
                showNotification('حدث خطأ في نسخ المنتج', 'error');
            });
        }
        
        function exportProducts() {
            const csvContent = [
                ['المنتج', 'الفئة', 'السعر', 'المخزون', 'التقييم', 'الوصف'],
                ...products.map(p => [
                    p.name,
                    productManager.getCategoryName(p.category),
                    p.price,
                    p.stock,
                    p.rating,
                    p.description || ''
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `products-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
        
        // System Request Functions
        function showCustomSystemModal(systemType) {
            document.getElementById('systemType').value = systemType;
            
            const titles = {
                'company': 'طلب نظام للشركات',
                'restaurant': 'طلب نظام للمطاعم',
                'pharmacy': 'طلب نظام للصيدليات'
            };
            
            document.querySelector('#customSystemModal h3').textContent = titles[systemType];
            document.getElementById('customSystemModal').classList.add('active');
        }
        
        function closeCustomSystemModal() {
            document.getElementById('customSystemModal').classList.remove('active');
            document.getElementById('customSystemForm').reset();
        }
        
        function submitSystemRequest() {
            const systemType = document.getElementById('systemType').value;
            const companyName = document.getElementById('companyName').value;
            const contactPerson = document.getElementById('contactPerson').value;
            const contactPhone = document.getElementById('contactPhone').value;
            const contactEmail = document.getElementById('contactEmail').value;
            const systemRequirements = document.getElementById('systemRequirements').value;
            
            // التحقق من صحة البريد الإلكتروني
            if (contactEmail && !validateEmail(contactEmail)) {
                showNotification('البريد الإلكتروني غير صحيح', 'error');
                return;
            }
            
            const request = {
                systemType: systemType,
                companyName: companyName,
                contactPerson: contactPerson,
                contactPhone: contactPhone,
                contactEmail: contactEmail,
                requirements: systemRequirements,
                status: 'pending',
                date: new Date().toLocaleDateString('ar-SA'),
                time: new Date().toLocaleTimeString('ar-SA'),
                timestamp: Date.now()
            };
            
            saveSystemRequestToFirebase(request).then(() => {
                closeCustomSystemModal();
                showNotification('تم إرسال طلبك بنجاح! سيتم التواصل معك خلال 24 ساعة');
            }).catch((error) => {
                console.error('Error saving system request:', error);
                showNotification('حدث خطأ في إرسال الطلب، يرجى المحاولة مرة أخرى', 'error');
            });
        }
        
        // Contact Form Functions
        function submitContactForm() {
            const name = document.getElementById('contactName').value;
            const phone = document.getElementById('contactPhone').value;
            const email = document.getElementById('contactEmail').value;
            const type = document.getElementById('contactType').value;
            const description = document.getElementById('contactDescription').value;
            const consent = document.getElementById('contactConsent').checked;
            
            if (!consent) {
                showNotification('يرجى الموافقة على الشروط والأحكام', 'error');
                return;
            }
            
            // التحقق من صحة البريد الإلكتروني إذا تم إدخاله
            if (email && !validateEmail(email)) {
                showNotification('البريد الإلكتروني غير صحيح', 'error');
                return;
            }
            
            const contactRequest = {
                name: name,
                phone: phone,
                email: email || 'غير محدد',
                type: type,
                description: description,
                status: 'new',
                date: new Date().toLocaleDateString('ar-SA'),
                time: new Date().toLocaleTimeString('ar-SA'),
                timestamp: Date.now()
            };
            
            saveContactRequestToFirebase(contactRequest).then(() => {
                document.getElementById('contactForm').reset();
                showNotification('تم إرسال طلبك بنجاح! سيتم التواصل معك خلال 24 ساعة');
            }).catch((error) => {
                console.error('Error saving contact request:', error);
                showNotification('حدث خطأ في إرسال الطلب، يرجى المحاولة مرة أخرى', 'error');
            });
        }
        
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        function getContactTypeText(type) {
            const typeMap = {
                'product': 'استفسار عن منتج',
                'system': 'طلب نظام مخصص',
                'project': 'مشروع تقني',
                'support': 'دعم فني',
                'partnership': 'شراكة تجارية',
                'other': 'أخرى'
            };
            return typeMap[type] || type;
        }
        
        function getSystemTypeText(type) {
            const typeMap = {
                'company': 'أنظمة الشركات',
                'restaurant': 'أنظمة المطاعم',
                'pharmacy': 'أنظمة الصيدليات'
            };
            return typeMap[type] || type;
        }
        
        // Admin Notification Functions
        function updateAdminNotificationCount() {
            if (!AppState.isAdminMode) return;
            
            const pendingOrders = orders.filter(order => order.status === 'pending').length;
            const pendingSystemRequests = systemRequests.filter(req => req.status === 'pending').length;
            const newContactRequests = contactRequests.filter(req => req.status === 'new').length;
            
            const totalUnread = pendingOrders + pendingSystemRequests + newContactRequests;
            
            const adminNotificationCount = document.getElementById('adminNotificationCount');
            if (adminNotificationCount) {
                if (totalUnread > 0) {
                    adminNotificationCount.textContent = totalUnread;
                    adminNotificationCount.classList.remove('hidden');
                } else {
                    adminNotificationCount.classList.add('hidden');
                }
            }
            
            const ordersBadge = document.getElementById('ordersNotificationBadge');
            if (ordersBadge) {
                if (pendingOrders > 0) {
                    ordersBadge.textContent = pendingOrders;
                    ordersBadge.classList.remove('hidden');
                } else {
                    ordersBadge.classList.add('hidden');
                }
            }
            
            const systemsBadge = document.getElementById('systemsNotificationBadge');
            if (systemsBadge) {
                if (pendingSystemRequests > 0) {
                    systemsBadge.textContent = pendingSystemRequests;
                    systemsBadge.classList.remove('hidden');
                } else {
                    systemsBadge.classList.add('hidden');
                }
            }
            
            const contactsBadge = document.getElementById('contactsNotificationBadge');
            if (contactsBadge) {
                if (newContactRequests > 0) {
                    contactsBadge.textContent = newContactRequests;
                    contactsBadge.classList.remove('hidden');
                } else {
                    contactsBadge.classList.add('hidden');
                }
            }
        }
        
        function openAdminNotifications() {
            if (!AppState.isAdminMode) return;
            loadAdminNotifications();
            document.getElementById('notificationsModal').classList.add('active');
        }
        
        function closeNotifications() {
            document.getElementById('notificationsModal').classList.remove('active');
        }
        
        function loadAdminNotifications() {
            const container = document.getElementById('notificationsList');
            container.innerHTML = '';
            
            const allNotifications = [
                ...orders.filter(order => order.status === 'pending').map(order => ({
                    type: 'order',
                    title: `طلب جديد من ${order.customer}`,
                    message: `طلب ${order.product.name} بقيمة ${order.total} جنيه`,
                    time: order.time,
                    date: order.date,
                    timestamp: order.timestamp,
                    action: () => showAdminSection('orders')
                })),
                ...systemRequests.filter(req => req.status === 'pending').map(req => ({
                    type: 'system',
                    title: `طلب نظام جديد من ${req.companyName}`,
                    message: `طلب ${getSystemTypeText(req.systemType)}`,
                    time: req.time || 'غير محدد',
                    date: req.date,
                    timestamp: req.timestamp,
                    action: () => showAdminSection('systems')
                })),
                ...contactRequests.filter(req => req.status === 'new').map(req => ({
                    type: 'contact',
                    title: `طلب تواصل جديد من ${req.name}`,
                    message: `${getContactTypeText(req.type)}`,
                    time: req.time,
                    date: req.date,
                    timestamp: req.timestamp,
                    action: () => showAdminSection('contacts')
                }))
            ];
            
            if (allNotifications.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">لا توجد إشعارات جديدة</p>';
                return;
            }
            
            allNotifications.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
            
            allNotifications.forEach(notification => {
                const notificationElement = document.createElement('div');
                notificationElement.className = 'p-4 bg-gray-50 rounded-lg border-r-4 border-purple-500 cursor-pointer hover:bg-gray-100 transition-colors';
                
                const iconClass = {
                    'order': 'fas fa-shopping-bag text-green-600',
                    'system': 'fas fa-cogs text-blue-600',
                    'contact': 'fas fa-envelope text-orange-600'
                };
                
                notificationElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 ml-3">
                            <i class="${iconClass[notification.type]}"></i>
                        </div>
                        <div class="flex-1">
                            <h5 class="font-semibold text-gray-900">${sanitizeHTML(notification.title)}</h5>
                            <p class="text-sm text-gray-600 mt-1">${sanitizeHTML(notification.message)}</p>
                            <p class="text-xs text-gray-500 mt-2">${notification.date} - ${notification.time}</p>
                        </div>
                        <div class="flex-shrink-0">
                            <i class="fas fa-chevron-left text-gray-400"></i>
                        </div>
                    </div>
                `;
                
                if (notification.action) {
                    notificationElement.addEventListener('click', () => {
                        closeNotifications();
                        notification.action();
                    });
                }
                
                container.appendChild(notificationElement);
            });
        }
        
        function markAsRead(notificationId) {
            database.ref(`notifications/${notificationId}`).update({ read: true });
        }
        
        function deleteNotification(notificationId) {
            database.ref(`notifications/${notificationId}`).remove();
        }
        
        function markAllAsRead() {
            const unreadNotifications = notificationSystem.notifications.filter(n => !n.read);
            const promises = unreadNotifications.map(n => 
                database.ref(`notifications/${n.id}`).update({ read: true })
            );
            
            Promise.all(promises).then(() => {
                showNotification('تم تحديد جميع الإشعارات كمقروءة');
                closeNotifications();
            });
        }
        
        // Reports Functions
        function showReports() {
            const reportsContainer = document.getElementById('adminReports');
            if (reportsContainer) {
                reportsContainer.innerHTML = `
                    <div class="p-6">
                        <h2 class="text-2xl font-bold mb-6">التقارير والإحصائيات</h2>
                        
                        <div class="bg-white rounded-lg shadow p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">إنشاء تقرير جديد</h3>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">نوع التقرير</label>
                                    <select id="reportType" class="w-full p-2 border rounded-lg">
                                        <option value="sales">تقرير المبيعات</option>
                                        <option value="products">تقرير المنتجات</option>
                                        <option value="orders">تقرير الطلبات</option>
                                        <option value="customers">تقرير العملاء</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">من تاريخ</label>
                                    <input type="date" id="startDate" class="w-full p-2 border rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">إلى تاريخ</label>
                                    <input type="date" id="endDate" class="w-full p-2 border rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">الإجراءات</label>
                                    <div class="flex space-x-2 space-x-reverse">
                                        <button id="generateReportBtn" class="flex-1 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                                            إنشاء
                                        </button>
                                        <select id="exportFormat" class="p-2 border rounded-lg">
                                            <option value="csv">CSV</option>
                                            <option value="json">JSON</option>
                                            <option value="pdf">PDF</option>
                                        </select>
                                        <button id="exportReportBtn" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                            تصدير
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="reportContent">
                            <div class="bg-white rounded-lg shadow p-8 text-center text-gray-500">
                                <i class="fas fa-chart-bar text-6xl mb-4"></i>
                                <p class="text-lg">اختر نوع التقرير وانقر على "إنشاء" لعرض التقرير</p>
                            </div>
                        </div>
                    </div>
                `;
                
                reportManager.setupReportEventListeners();
                
                const today = new Date();
                const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
                document.getElementById('startDate').value = lastMonth.toISOString().split('T')[0];
                document.getElementById('endDate').value = today.toISOString().split('T')[0];
            }
        }
        
        function exportData() {
            const data = {
                products: products,
                orders: orders,
                systemRequests: systemRequests,
                contactRequests: contactRequests,
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `ayk-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showNotification('تم تصدير البيانات بنجاح');
        }
        
        // Backup Functions
        function showBackupSettings() {
            const container = document.getElementById('backupSettings');
            if (!container) return;
            
            container.innerHTML = `
                <div class="p-6">
                    <h2 class="text-2xl font-bold mb-6">النسخ الاحتياطي واستعادة البيانات</h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">إنشاء نسخة احتياطية</h3>
                            <p class="text-gray-600 mb-4">
                                قم بإنشاء نسخة احتياطية من جميع بيانات الموقع بما فيها المنتجات والطلبات والعملاء.
                            </p>
                            <div class="space-y-3">
                                <button id="createBackupBtn" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                    <i class="fas fa-download ml-2"></i>
                                    إنشاء نسخة احتياطية
                                </button>
                                <div class="text-sm text-gray-500">
                                    <i class="fas fa-info-circle ml-1"></i>
                                    يتم إنشاء نسخة احتياطية تلقائية كل 24 ساعة
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">استعادة نسخة احتياطية</h3>
                            <p class="text-gray-600 mb-4">
                                قم باستعادة البيانات من نسخة احتياطية سابقة. تأكد من اختيار الملف الصحيح.
                            </p>
                            <div class="space-y-3">
                                <button id="restoreBackupBtn" class="w-full bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700">
                                    <i class="fas fa-upload ml-2"></i>
                                    استعادة نسخة احتياطية
                                </button>
                                <div class="text-sm text-red-500">
                                    <i class="fas fa-exclamation-triangle ml-1"></i>
                                    تحذير: هذا الإجراء سيستبدل جميع البيانات الحالية
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">النسخ الاحتياطية السابقة</h3>
                        <div id="backupList">
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-history text-4xl mb-3 block"></i>
                                جاري تحميل النسخ الاحتياطية...
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            loadBackupList();
            backupManager.setupBackupEventListeners();
        }
        
        async function loadBackupList() {
            const container = document.getElementById('backupList');
            if (!container) return;
            
            try {
                const backups = await backupManager.getBackupList();
                if (backups.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-inbox text-4xl mb-3 block"></i>
                            لا توجد نسخ احتياطية سابقة
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = `
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-right">التاريخ والوقت</th>
                                    <th class="px-4 py-2 text-right">الحجم</th>
                                    <th class="px-4 py-2 text-right">النوع</th>
                                    <th class="px-4 py-2 text-right">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y">
                                ${backups.map(backup => `
                                    <tr>
                                        <td class="px-4 py-2">
                                            <div class="font-medium">${formatDate(new Date(backup.timestamp))}</div>
                                            <div class="text-sm text-gray-500">${new Date(backup.timestamp).toLocaleTimeString('ar-SA')}</div>
                                        </td>
                                        <td class="px-4 py-2">${formatFileSize(backup.size)}</td>
                                        <td class="px-4 py-2">
                                            <span class="px-2 py-1 text-xs rounded-full ${backup.auto ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'}">
                                                ${backup.auto ? 'تلقائي' : 'يدوي'}
                                            </span>
                                        </td>
                                        <td class="px-4 py-2">
                                            <div class="flex space-x-2 space-x-reverse">
                                                <button onclick="downloadBackup('${backup.id}')" class="text-blue-600 hover:text-blue-800">
                                                    <i class="fas fa-download"></i>
                                                </button>
                                                <button onclick="deleteBackup('${backup.id}')" class="text-red-600 hover:text-red-800">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading backup list:', error);
                container.innerHTML = `
                    <div class="text-center py-8 text-red-500">
                        <i class="fas fa-exclamation-triangle text-4xl mb-3 block"></i>
                        حدث خطأ في تحميل النسخ الاحتياطية
                    </div>
                `;
            }
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        async function downloadBackup(backupId) {
            try {
                const snapshot = await database.ref(`backups/${backupId}`).once('value');
                const backup = snapshot.val();
                
                if (!backup) {
                    showNotification('النسخة الاحتياطية غير موجودة', 'error');
                    return;
                }
                
                const backupBlob = new Blob([JSON.stringify(backup.data, null, 2)], {
                    type: 'application/json'
                });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(backupBlob);
                link.download = `ayk_backup_${formatDate(new Date(backup.timestamp))}.json`;
                link.click();
                showNotification('تم تحميل النسخة الاحتياطية');
            } catch (error) {
                console.error('Error downloading backup:', error);
                showNotification('حدث خطأ في تحميل النسخة الاحتياطية', 'error');
            }
        }
        
        async function deleteBackup(backupId) {
            if (!confirm('هل أنت متأكد من حذف هذه النسخة الاحتياطية؟')) {
                return;
            }
            
            try {
                await backupManager.deleteBackup(backupId);
                loadBackupList();
            } catch (error) {
                console.error('Error deleting backup:', error);
                showNotification('حدث خطأ في حذف النسخة الاحتياطية', 'error');
            }
        }
        
        // Security Functions
        function secureAdminAccess() {
            const sessionTimeout = 30 * 60 * 1000; // 30 دقيقة
            let lastActivity = Date.now();
            
            // تحديث وقت النشاط
            function updateActivity() {
                lastActivity = Date.now();
            }
            
            document.addEventListener('mousemove', updateActivity);
            document.addEventListener('keypress', updateActivity);
            
            // التحقق من انتهاء الجلسة
            setInterval(() => {
                if (AppState.isAdminMode && Date.now() - lastActivity > sessionTimeout) {
                    exitAdmin();
                    showNotification('انتهت الجلسة، يرجى تسجيل الدخول مرة أخرى', 'info');
                }
            }, 60000); // تحقق كل دقيقة
        }
        
        // XSS Protection
        function sanitizeHTML(str) {
            if (typeof str !== 'string') return str;
            
            const temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        }
        
        // Modal Listeners
        function setupModalListeners() {
            // مستمع النقر خارج النوافذ المنبثقة
            const modalClickListener = function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('active');
                }
            };
            
            document.addEventListener('click', modalClickListener);
            
            // إزالة المستمع عند الخروج من وضع المسؤول
            window.addEventListener('beforeunload', function() {
                document.removeEventListener('click', modalClickListener);
            });
        }
        
        // Utility Functions
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-20 left-4 px-6 py-3 rounded-lg text-white z-50 ${type === 'error' ? 'bg-red-500' : 'bg-green-500'} message`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // إزالة التحديث التلقائي واستخدام Firebase Realtime Database
        // تم إزالة هذا الكود لأننا نستخدم مستمعي Firebase الآن
    </script>
</body>
</html>


